/**
 * @name is-media-descriptor
 * @fileoverview Is given string a valid media descriptor (including media query)?
 * @version 4.0.0
 * @author Roy Revelt, Codsen Ltd
 * @license MIT
 * {@link https://codsen.com/os/is-media-descriptor/}
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).isMediaDescriptor={})}(this,(function(e){"use strict";const t=[],o=[];function s(e,s){if(e===s)return 0;const i=e;e.length>s.length&&(e=s,s=i);let f=e.length,r=s.length;for(;f>0&&e.charCodeAt(~-f)===s.charCodeAt(~-r);)f--,r--;let n,l,a,m,c=0;for(;c<f&&e.charCodeAt(c)===s.charCodeAt(c);)c++;if(f-=c,r-=c,0===f)return r;let d=0,u=0;for(;d<f;)o[d]=e.charCodeAt(c+d),t[d]=++d;for(;u<r;)for(n=s.charCodeAt(c+u),a=u++,l=u,d=0;d<f;d++)m=n===o[d]?a:a+1,a=t[d],l=t[d]=a>l?m>l?l+1:m:m>a?a+1:m;return l}
/**
 * @name string-process-comma-separated
 * @fileoverview Extracts chunks from possibly comma or whatever-separated string
 * @version 3.0.0
 * @author Roy Revelt, Codsen Ltd
 * @license MIT
 * {@link https://codsen.com/os/string-process-comma-separated/}
 */const i=["all","aural","braille","embossed","handheld","print","projection","screen","speech","tty","tv"],f=["width","min-width","max-width","height","min-height","max-height","aspect-ratio","min-aspect-ratio","max-aspect-ratio","orientation","resolution","min-resolution","max-resolution","scan","grid","update","overflow-block","overflow-inline","color","min-color","max-color","color-index","min-color-index","max-color-index","monochrome","color-gamut","pointer","hover","any-pointer","any-hover"],r=/^\w+$/g;const n={offset:0};e.defaults=n,e.isMediaD=function(e,t){const o={...n,...t};if(o.offset&&!Number.isInteger(o.offset))throw new Error(`is-media-descriptor: [THROW_ID_01] opts.offset must be an integer, it was given as ${o.offset} (type ${typeof o.offset})`);if(o.offset||(o.offset=0),"string"!=typeof e)return[];if(!e.trim())return[];const l=[];let a=0,m=e.length;const c=e.trim();if(e!==e.trim()){const t=[];if(!e[0].trim())for(let s=0,i=e.length;s<i;s++)if(e[s].trim()){t.push([0+o.offset,s+o.offset]),a=s;break}if(!e[e.length-1].trim())for(let s=e.length;s--;)if(e[s].trim()){t.push([s+1+o.offset,e.length+o.offset]),m=s+1;break}l.push({idxFrom:t[0][0],idxTo:t[t.length-1][1],message:"Remove whitespace.",fix:{ranges:t}})}if(i.includes(c))return l;if(["only","not"].includes(c))l.push({idxFrom:a+o.offset,idxTo:m+o.offset,message:"Missing media type or condition.",fix:null});else if(!c.match(r)||c.includes("(")||c.includes(")")){let e=!1;const[t,s]=Array.from(c).reduce(((t,s,i)=>")"===s?(!e&&t[1]+1>t[0]&&(e=!0),[t[0],t[1]+1]):"("===s?[t[0]+1,t[1]]:(";"===s&&l.push({idxFrom:i+o.offset,idxTo:i+1+o.offset,message:"Semicolon found!",fix:null}),t)),[0,0]);if(e&&t===s&&l.push({idxFrom:a+o.offset,idxTo:m+o.offset,message:"Some closing brackets are before their opening counterparts.",fix:null}),t>s?l.push({idxFrom:a+o.offset,idxTo:m+o.offset,message:"More opening brackets than closing.",fix:null}):s>t&&l.push({idxFrom:a+o.offset,idxTo:m+o.offset,message:"More closing brackets than opening.",fix:null}),!l.length&&c.match(/\(\s*\)/g)){let e,t=null;for(let s=0,i=c.length;s<i;s++)"("===c[s]?(t=s,e=!1):")"===c[s]&&t?e?e=!0:l.push({idxFrom:t+o.offset,idxTo:s+1+o.offset,message:"Empty bracket pair.",fix:null}):c[s].trim()&&(e=!0)}if(l.length)return l;!function(e,t){if("string"!=typeof e)throw new Error(`string-process-comma-separated: [THROW_ID_01] input must be string! It was given as ${typeof e}, equal to:\n${JSON.stringify(e,null,4)}`);if(!e.length||!t||!t.cb&&!t.errCb)return;const o={from:0,to:e.length,offset:0,leadingWhitespaceOK:!1,trailingWhitespaceOK:!1,oneSpaceAfterCommaOK:!1,innerWhitespaceAllowed:!1,separator:",",cb:null,errCb:null,...t};Number.isInteger(t.from)||(o.from=0),Number.isInteger(t.to)||(o.to=e.length),Number.isInteger(t.offset)||(o.offset=0);let s=null,i=null,f=!1,r=[],n=null,l=!0;for(let t=o.from;t<o.to;t++){if(e[t].trim()&&e[t]!==o.separator&&(n=t),null!==s||!e[t].trim()||o.separator&&e[t]===o.separator||(f||(f=!0),r.length&&(r.length>1&&r.forEach(((e,t)=>{t&&o.errCb([[e+o.offset,e+1+o.offset]],"Remove separator.",l)})),r=[]),s=t),Number.isInteger(s)&&(t>s&&o.separator&&e[t]===o.separator||t+1===o.to)&&(e.slice(s,t+1===o.to&&e[t]!==o.separator&&e[t].trim()?t+1:t),"function"==typeof o.cb&&o.cb(s+o.offset,(t+1===o.to&&e[t]!==o.separator&&e[t].trim()?t+1:n+1)+o.offset),s=null),e[t].trim()||null!==i||(i=t),null!==i&&(e[t].trim()||t+1===o.to)){if(i===o.from)o.leadingWhitespaceOK||"function"!=typeof o.errCb||o.errCb([[i+o.offset,(t+1===o.to?t+1:t)+o.offset]],"Remove whitespace.",l);else if(e[t].trim()||t+1!==o.to){if(!(o.oneSpaceAfterCommaOK&&e[t].trim()&&t>o.from+1&&" "===e[t-1]&&","===e[t-2]||o.innerWhitespaceAllowed&&f&&e[i-1]&&e[t].trim()&&e[t]!==o.separator&&e[i-1]!==o.separator)){let s=i,r=t;t+1!==o.to||e[t]===o.separator||e[t].trim()||(r+=1);let n="";o.oneSpaceAfterCommaOK&&(" "===e[i]&&e[i-1]===o.separator?s+=1:" "!==e[i]&&(n=" "));let a="Remove whitespace.";!o.innerWhitespaceAllowed&&f&&e[i-1]&&e[t].trim()&&e[t]!==o.separator&&e[i-1]!==o.separator&&(l=!1,a="Bad whitespace."),o.errCb(n.length?[[s+o.offset,r+o.offset,n]]:[[s+o.offset,r+o.offset]],a,l),l=!0}}else o.trailingWhitespaceOK||"function"!=typeof o.errCb||o.errCb([[i+o.offset,t+1+o.offset]],"Remove whitespace.",l);i=null}e[t]===o.separator&&(f?r.push(t):o.errCb([[t+o.offset,t+1+o.offset]],"Remove separator.",l)),t+1===o.to&&r.forEach((e=>{o.errCb([[e+o.offset,e+1+o.offset]],"Remove separator.",l)}))}}(c,{offset:o.offset,leadingWhitespaceOK:!1,trailingWhitespaceOK:!1,oneSpaceAfterCommaOK:!0,innerWhitespaceAllowed:!0,separator:",",cb:(e,t)=>{!function(e,t,o){let s=null;const n=[];let l=null,a=!0,m=!0,c=!0,d=!1;const u=[];for(let p=t.idxFrom;p<=t.idxTo;p++){if(")"===e[p]){const s=u.pop(),n=e.slice(s+1,p);n.includes("(")||n.includes(")")||n.match(r)&&(f.includes(n.toLowerCase().trim())||o.push({idxFrom:s+1+t.offset,idxTo:p+t.offset,message:`Unrecognised "${n.trim()}".`,fix:null}));const l=new RegExp(i.join("|"),"gi");(n.match(l)||[]).forEach((s=>{const i=e.indexOf(s);o.push({idxFrom:i+t.offset,idxTo:i+s.length+t.offset,message:`Media type "${s}" inside brackets.`,fix:null})}))}if(e[p]&&e[p].trim().length&&null!==l){if("("===e[l-1]||")"===e[p])o.push({idxFrom:l+t.offset,idxTo:p+t.offset,message:"Bad whitespace.",fix:{ranges:[[l+t.offset,p+t.offset]]}});else if(l<p-1||" "!==e[p-1]){let s=l+t.offset,i=p+t.offset,f=" ";l!==p-1&&(" "===e[l]?(s+=1,f=null):" "===e[p-1]&&(i-=1,f=null)),o.push({idxFrom:l+t.offset,idxTo:p+t.offset,message:"Bad whitespace.",fix:{ranges:[f?[s,i," "]:[s,i]]}})}l=null}if(e[p]&&!e[p].trim().length&&null===l&&(l=p),!(null===s||e[p]&&e[p].trim().length&&"("!==e[p]||u.length)){const r=e.slice(s,p);if(n.push(r.toLowerCase()),!d||(a||m)&&"and"!==r)if(c&&["not","only"].includes(r))c=!1,m=!1;else if(a||m){if(r.startsWith("("))if(m);else{let i=`Media condition "${e.slice(s,p)}" can't be here.`;"not"===n[n.length-2]&&(i='"not" can be only in front of media type.'),o.push({idxFrom:s+t.offset,idxTo:p+t.offset,message:i,fix:null})}else{if(!a){let n=`Expected brackets on "${r}".`,l=null,a=p+t.offset;if(["not","else","or"].includes(r.toLowerCase()))n=`"${r}" can't be here.`;else if(i.includes(r.toLowerCase()))n="Unexpected media type, try using a comma.";else if(f.includes(r.toLowerCase()))n="Missing brackets.",l={ranges:[[s+t.offset,s+t.offset,"("],[p+t.offset,p+t.offset,")"]]};else if(e.slice(p).trim().startsWith(":")){const e=r.slice(0,p).trim();n=`Expected brackets on "${e}" and its value.`,a=s+e.length+t.offset}o.push({idxFrom:s+t.offset,idxTo:a,message:n,fix:l});break}if(i.includes(r.toLowerCase()))a=!1,m=!1;else{let e=`Unrecognised "${r}".`;r.match(/\w/g)?["and","only","or","not"].includes(r.toLowerCase())&&(e=`"${r}" instead of a media type.`):e=`Strange symbol${1===r.trim().length?"":"s"} "${r}".`,o.push({idxFrom:s+t.offset,idxTo:p+t.offset,message:e,fix:null})}}d=!0}else o.push({idxFrom:s+t.offset,idxTo:p+t.offset,message:`Unrecognised media type "${e.slice(s,p)}".`,fix:null});else"and"!==r.toLowerCase()?o.push({idxFrom:s+t.offset,idxTo:p+t.offset,message:`Expected "and", found "${r}".`,fix:null}):e[p]?e[p].trim()&&o.push({idxFrom:s+t.offset,idxTo:p+t.offset,message:'Space after "and" missing.',fix:{ranges:[[p+t.offset,p+t.offset," "]]}}):o.push({idxFrom:s+t.offset,idxTo:p+t.offset,message:`Dangling "${r}".`,fix:{ranges:[[e.slice(0,s).trim().length+t.offset,p+t.offset]]}}),d=!1,m=!0;s=null,c&&(c=!1)}null===s&&e[p]&&e[p].trim().length&&")"!==e[p]&&(s=p),"("===e[p]&&u.push(p)}}(c,{...o,idxFrom:e-o.offset,idxTo:t-o.offset},l)},errCb:(e,t)=>{}})}else for(let e=0,t=i.length;e<t;e++){if(1===s(i[e],c)){l.push({idxFrom:a+o.offset,idxTo:m+o.offset,message:`Did you mean "${i[e]}"?`,fix:{ranges:[[a+o.offset,m+o.offset,i[e]]]}});break}e===t-1&&l.push({idxFrom:a+o.offset,idxTo:m+o.offset,message:`Unrecognised media type "${c}".`,fix:null})}return l},e.version="4.0.0",Object.defineProperty(e,"__esModule",{value:!0})}));

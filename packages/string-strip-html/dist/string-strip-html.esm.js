/**
 * @name string-strip-html
 * @fileoverview Strips HTML tags from strings. No parser, accepts mixed sources.
 * @version 8.2.9
 * @author Roy Revelt, Codsen Ltd
 * @license MIT
 * {@link https://codsen.com/os/string-strip-html/}
 */

import L from"lodash.isplainobject";import I from"lodash.trim";import K from"lodash.without";import{decode as _}from"html-entities";import{rApply as Q}from"ranges-apply";import{Ranges as Z}from"ranges-push";import{right as M}from"string-left-right";function x(n){return/[-_A-Za-z0-9]/.test(n)}function P(n,b){if(!n)return[];if(Array.isArray(n))return n.filter(S=>typeof S=="string"&&S.trim());if(typeof n=="string")return n.trim()?[n]:[];throw new TypeError(`string-strip-html/stripHtml(): [THROW_ID_03] ${b} must be array containing zero or more strings or something falsey. Currently it's equal to: ${n}, that a type of ${typeof n}.`)}function z(n,b,S,E){for(let A=b,j=n.length;A<j;A++){if(n.startsWith(S,A))return!0;if(n.startsWith(E,A))return!1}return!1}function q(n,b,S){return!n||!n.quotes||!z(b,S+1,n.quotes.value,">")}var D="8.2.9";var be=D,v={ignoreTags:[],onlyStripTags:[],stripTogetherWithTheirContents:["script","style","xml"],skipHtmlDecoding:!1,trimOnlySpaces:!1,dumpLinkHrefsNearby:{enabled:!1,putOnNewLine:!1,wrapHeads:"",wrapTails:""},cb:null};function X(n,b){let S=Date.now(),E=new Set(["!doctype","abbr","address","area","article","aside","audio","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","doctype","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","math","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","param","picture","pre","progress","rb","rp","rt","rtc","ruby","samp","script","section","select","slot","small","source","span","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","ul","var","video","wbr","xml"]),A=new Set(["a","b","i","p","q","s","u"]),j=new Set([".",",","?",";",")","\u2026",'"',"\xBB"]),m=[],p=[],u=[],e={};function G(){e={attributes:[]}}G();let O=null,N=null,l={},d={tagName:"",hrefValue:"",openingTagEnds:void 0},f="",C=!1,B=null;function V(t){return t!=null}function Y(t){return typeof t=="string"}function R(t,r,s){if(""+t,""+JSON.stringify(r.stripTogetherWithTheirContents,null,0)+e.name,Array.isArray(r.stripTogetherWithTheirContents)&&(r.stripTogetherWithTheirContents.includes(e.name)||r.stripTogetherWithTheirContents.includes("*")))if(""+`[${33}mrangedOpeningTags[${39}m`+JSON.stringify(m,null,4),Array.isArray(m)&&m.some(i=>i.name===e.name&&i.lastClosingBracketAt<t)){""+31+39;for(let i=m.length;i--;)if(m[i].name===e.name){""+JSON.stringify(s.current(),null,0),""+m[i].lastOpeningBracketAt+t,""+`[${33}mrangedOpeningTags[${39}m`+JSON.stringify(m,null,4),(r.stripTogetherWithTheirContents.includes(e.name)||r.stripTogetherWithTheirContents.includes("*"))&&(""+`[${33}mfilteredTagLocations[${39}m`+JSON.stringify(u,null,4),u=u.filter(([c,$])=>(c<m[i].lastOpeningBracketAt||c>=t+1)&&($<=m[i].lastOpeningBracketAt||$>t+1)),""+`[${33}mfilteredTagLocations[${39}m`+JSON.stringify(u,null,4));let o=t+1;e.lastClosingBracketAt&&(o=e.lastClosingBracketAt+1),""+`[${32}mPUSH[${39}m`+m[i].lastOpeningBracketAt+o,u.push([m[i].lastOpeningBracketAt,o]),j.has(n[t])&&r.cb?r.cb({tag:e,deleteFrom:m[i].lastOpeningBracketAt,deleteTo:t+1,insert:null,rangesArr:s,proposedReturn:[m[i].lastOpeningBracketAt,t,null]}):r.cb&&r.cb({tag:e,deleteFrom:m[i].lastOpeningBracketAt,deleteTo:t,insert:"",rangesArr:s,proposedReturn:[m[i].lastOpeningBracketAt,t,""]}),m.splice(i,1),""+33+39+JSON.stringify(m,null,4);break}}else""+31+39,m.push(e),""+33+39+JSON.stringify(m,null,4)}function W(t,r,s,i,o,c){""+35+39,""+`[${33}mcurrCharIdx[${39}m`+JSON.stringify(r,null,0)+`[${33}mstr2[currCharIdx][${39}m`+JSON.stringify(t[r],null,0)+`[${33}mstr2[tag.leftOuterWhitespace][${39}m`+JSON.stringify(t[e.leftOuterWhitespace],null,0)+`[${33}mstr2[tag.leftOuterWhitespace - 1][${39}m`+JSON.stringify(t[e.leftOuterWhitespace-1],null,0)+`[${33}mfromIdx[${39}m`+JSON.stringify(s,null,0)+`[${33}mtoIdx[${39}m`+JSON.stringify(i,null,0);let $="";if(Number.isInteger(s)&&s<o&&($+=t.slice(s,o),""+JSON.stringify($,null,0)+$.length+s+o),Number.isInteger(i)&&i>c+1){let h=t.slice(c+1,i);h.includes(`
`)&&T(i,t)?$+=" ":$+=h,""+JSON.stringify($,null,0)+$.length+(c+1)+i}if(""+JSON.stringify($,null,0)+$.length,!j.has(t[r])&&t[r]!=="!"){let h=$.match(/\n/g);return Array.isArray(h)&&h.length?h.length===1?`
`:h.length===2?`

`:`


`:" "}return""}function w(t){if(t.dumpLinkHrefsNearby.enabled&&d.tagName&&d.tagName===e.name&&e.lastOpeningBracketAt&&(d.openingTagEnds&&e.lastOpeningBracketAt>d.openingTagEnds||!d.openingTagEnds)&&(C=!0,""+C),C){let r=t.dumpLinkHrefsNearby.putOnNewLine?`

`:"";f=`${r}${d.hrefValue}${r}`,""+f}}function T(t,r){return r?r[t]==="<"&&r[t+1]!=="%":n[t]==="<"&&n[t+1]!=="%"}function k(t){return n[t]===">"&&n[t-1]!=="%"}if(typeof n!="string")throw new TypeError(`string-strip-html/stripHtml(): [THROW_ID_01] Input must be string! Currently it's: ${(typeof n).toLowerCase()}, equal to:
${JSON.stringify(n,null,4)}`);if(b&&!L(b))throw new TypeError(`string-strip-html/stripHtml(): [THROW_ID_02] Optional Options Object must be a plain object! Currently it's: ${(typeof b).toLowerCase()}, equal to:
${JSON.stringify(b,null,4)}`);function J(){C&&(d={tagName:"",hrefValue:"",openingTagEnds:void 0},C=!1)}let a={...v,...b};if(Object.prototype.hasOwnProperty.call(a,"returnRangesOnly"))throw new TypeError("string-strip-html/stripHtml(): [THROW_ID_03] opts.returnRangesOnly has been removed from the API since v.5 release.");a.ignoreTags=P(a.ignoreTags,"opts.ignoreTags"),a.onlyStripTags=P(a.onlyStripTags,"opts.onlyStripTags");let F=!!a.onlyStripTags.length;if(a.onlyStripTags.length&&a.ignoreTags.length&&(a.onlyStripTags=K(a.onlyStripTags,...a.ignoreTags)),L(a.dumpLinkHrefsNearby)||(a.dumpLinkHrefsNearby={...v.dumpLinkHrefsNearby}),a.dumpLinkHrefsNearby=v.dumpLinkHrefsNearby,b&&Object.prototype.hasOwnProperty.call(b,"dumpLinkHrefsNearby")&&V(b.dumpLinkHrefsNearby)){if(L(b.dumpLinkHrefsNearby))a.dumpLinkHrefsNearby={...v.dumpLinkHrefsNearby,...b.dumpLinkHrefsNearby};else if(b.dumpLinkHrefsNearby)throw new TypeError(`string-strip-html/stripHtml(): [THROW_ID_04] Optional Options Object's key dumpLinkHrefsNearby was set to ${typeof b.dumpLinkHrefsNearby}, equal to ${JSON.stringify(b.dumpLinkHrefsNearby,null,4)}. The only allowed value is a plain object. See the API reference.`)}a.stripTogetherWithTheirContents?typeof a.stripTogetherWithTheirContents=="string"&&a.stripTogetherWithTheirContents.length&&(a.stripTogetherWithTheirContents=[a.stripTogetherWithTheirContents]):a.stripTogetherWithTheirContents=[];let H={};if(a.stripTogetherWithTheirContents&&Array.isArray(a.stripTogetherWithTheirContents)&&a.stripTogetherWithTheirContents.length&&!a.stripTogetherWithTheirContents.every((t,r)=>typeof t!="string"?(H.el=t,H.i=r,!1):!0))throw new TypeError(`string-strip-html/stripHtml(): [THROW_ID_05] Optional Options Object's key stripTogetherWithTheirContents was set to contain not just string elements! For example, element at index ${H.i} has a value ${H.el} which is not string but ${(typeof H.el).toLowerCase()}.`);""+typeof a.cb,a.cb||(a.cb=({rangesArr:t,proposedReturn:r})=>{r&&t.push(...r)}),""+`[${33}mopts[${39}m`+JSON.stringify(a,null,4)+`[${33}minput[${39}m`+n;let g=new Z({limitToBeAddedWhitespace:!0,limitLinebreaksCount:2});if(!a.skipHtmlDecoding)for(;n!==_(n,{scope:"strict"});)n=_(n,{scope:"strict"});for(let t=0,r=n.length;t<r;t++){if(""+36+39+35+`str[ ${t} ] = ${`[${31}m${n[t]&&n[t].trim()===""?n[t]===null?"null":n[t]===`
`?"line break":n[t]==="	"?"tab":"space":n[t]}[${39}m`}`+39+36+39,Object.keys(e).length>1&&e.lastClosingBracketAt&&e.lastClosingBracketAt<t&&n[t]!==" "&&B===null&&(B=t),k(t)&&(!e||Object.keys(e).length<2)&&t>1){for(let s=t;s--;)if(""+35+`str[${s}] = ${n[s]}`+39,n[s-1]===void 0||k(s)){let i=n[s-1]===void 0?s:s+1,o=n.slice(i,t+1);if(""+`[${31}m${o}[${39}m`,""+I(o.trim().split(/\s+/).filter(c=>c.trim()).filter((c,$)=>$===0),"/>"),n!==`<${I(o.trim(),"/>")}>`&&[...E].some(c=>I(o.trim().split(/\s+/).filter($=>$.trim()).filter(($,h)=>h===0),"/>").toLowerCase()===c)&&X(`<${o.trim()}>`,a).result===""){(!p.length||p[p.length-1][0]!==e.lastOpeningBracketAt)&&(p.push([i,t+1]),""+`[${32}mPUSH[${39}m`+e.lastOpeningBracketAt+(e.lastClosingBracketAt+1)),(!u.length||u[u.length-1][0]!==e.lastOpeningBracketAt)&&(u.push([i,t+1]),""+`[${32}mPUSH[${39}m`+e.lastOpeningBracketAt+(e.lastClosingBracketAt+1));let c=W(n,t,i,t+1,i,t+1);""+33+`SUBMIT RANGE #3: [${i}, ${t+1}, "${c}"]`+39;let $=t+1;if(n[$]&&!n[$].trim()){for(let h=$;h<r;h++)if(n[h].trim()){$=h;break}}""+i+$+c,a.cb({tag:e,deleteFrom:i,deleteTo:$,insert:c,rangesArr:g,proposedReturn:[i,$,c]})}break}}if(n[t]==="/"&&!(e.quotes&&e.quotes.value)&&Number.isInteger(e.lastOpeningBracketAt)&&!Number.isInteger(e.lastClosingBracketAt)&&(""+33+39,e.slashPresent=t),n[t]==='"'||n[t]==="'")if(e.nameStarts&&e.quotes&&e.quotes.value&&e.quotes.value===n[t]){l.valueEnds=t,l.value=n.slice(l.valueStarts,t),""+`[${33}mattrObj[${39}m`+JSON.stringify(l,null,4),e.attributes.push(l),l={},e.quotes=void 0;let s;a.dumpLinkHrefsNearby.enabled&&e.attributes.some(i=>{if(i.name&&i.name.toLowerCase()==="href")return s=`${a.dumpLinkHrefsNearby.wrapHeads||""}${i.value}${a.dumpLinkHrefsNearby.wrapTails||""}`,!0})&&(d={tagName:e.name,hrefValue:s,openingTagEnds:void 0},""+`[${32}mSET[${39}m`+`[${33}mhrefDump[${39}m`+JSON.stringify(d,null,4))}else!e.quotes&&e.nameStarts&&(""+`[${32}mSET[${39}m`+n[t]+t,e.quotes={},e.quotes.value=n[t],e.quotes.start=t,l.nameStarts&&l.nameEnds&&l.nameEnds<t&&l.nameStarts<t&&!l.valueStarts&&(l.name=n.slice(l.nameStarts,l.nameEnds),""+`[${32}mSET[${39}m`+`[${33}mattrObj[${39}m`+JSON.stringify(l,null,4)));if(e.nameStarts!==void 0&&e.nameEnds===void 0&&(!n[t].trim()||!x(n[t]))){if(e.nameEnds=t,""+`[${32}mSET[${39}m`+33+39+e.nameEnds,e.name=n.slice(e.nameStarts,e.nameEnds+(!k(t)&&n[t]!=="/"&&n[t+1]===void 0?1:0)),""+`[${32}mSET[${39}m`+33+39+e.name,""+`[${33}mtag[${39}m`+JSON.stringify(e,null,4),n[e.nameStarts-1]!=="!"&&!e.name.replace(/-/g,"").length||/^\d+$/.test(e.name[0])){e={};continue}if(T(t)){w(a),""+`[${33}mstringToInsertAfter[${39}m`+JSON.stringify(f,null,4);let s=W(n,t,e.leftOuterWhitespace,t,e.lastOpeningBracketAt,t);""+33+`cb()-PUSH: [${e.leftOuterWhitespace}, ${t}, "${s}${f}${s}"]`+39,""+`[${33}mtag[${39}m`+JSON.stringify(e,null,4),(a.stripTogetherWithTheirContents.includes(e.name)||a.stripTogetherWithTheirContents.includes("*"))&&(""+`[${33}mfilteredTagLocations[${39}m`+JSON.stringify(u,null,4),u=u.filter(([i,o])=>!(i===e.leftOuterWhitespace&&o===t)),""+`[${33}mfilteredTagLocations[${39}m`+JSON.stringify(u,null,4)),a.cb({tag:e,deleteFrom:e.leftOuterWhitespace,deleteTo:t,insert:`${s}${f}${s}`,rangesArr:g,proposedReturn:[e.leftOuterWhitespace,t,`${s}${f}${s}`]}),J(),R(t,a,g)}}if(e.quotes&&e.quotes.start&&e.quotes.start<t&&!e.quotes.end&&l.nameEnds&&l.equalsAt&&!l.valueStarts&&(""+`[${32}mSET[${39}m`+33+39+l.valueStarts,l.valueStarts=t),!e.quotes&&l.nameEnds&&n[t]==="="&&!l.valueStarts&&!l.equalsAt&&(l.equalsAt=t,""+`[${32}mSET[${39}m`+33+39+l.equalsAt),!e.quotes&&l.nameStarts&&l.nameEnds&&!l.valueStarts&&n[t].trim()&&n[t]!=="="&&(e.attributes.push(l),l={}),!e.quotes&&l.nameStarts&&!l.nameEnds&&(n[t].trim()?n[t]==="="?l.equalsAt||(l.nameEnds=t,""+`[${32}mSET[${39}m`+`[${33}mattrObj.nameEnds[${39}m`+JSON.stringify(l.nameEnds,null,4),l.equalsAt=t,""+`[${32}mSET[${39}m`+`[${33}mattrObj.equalsAt[${39}m`+JSON.stringify(l.equalsAt,null,4),l.name=n.slice(l.nameStarts,l.nameEnds)):n[t]==="/"||k(t)?(""+`[${32}mSET[${39}m`+`[${33}mattrObj.nameEnds[${39}m`+JSON.stringify(l.nameEnds,null,4),l.nameEnds=t,l.name=n.slice(l.nameStarts,l.nameEnds),""+33+39,e.attributes.push(l),l={}):T(t)&&(""+33+39+`[${31}mTODO[${39}m`,l.nameEnds=t,l.name=n.slice(l.nameStarts,l.nameEnds),e.attributes.push(l),l={}):(l.nameEnds=t,""+`[${32}mSET[${39}m`+`[${33}mattrObj.nameEnds[${39}m`+JSON.stringify(l.nameEnds,null,4),l.name=n.slice(l.nameStarts,l.nameEnds))),!e.quotes&&e.nameEnds<t&&!n[t-1].trim()&&n[t].trim()&&!"<>/!".includes(n[t])&&!l.nameStarts&&!e.lastClosingBracketAt&&(l.nameStarts=t,""+`[${32}mSET[${39}m`+33+39+l.nameStarts),e.lastOpeningBracketAt!==null&&e.lastOpeningBracketAt<t&&n[t]==="/"&&e.onlyPlausible&&(e.onlyPlausible=!1),e.lastOpeningBracketAt!==null&&e.lastOpeningBracketAt<t&&n[t]!=="/"&&(e.onlyPlausible===void 0&&((!n[t].trim()||T(t))&&!e.slashPresent?e.onlyPlausible=!0:e.onlyPlausible=!1,""+`[${32}mSET[${39}m`+33+39+e.onlyPlausible),n[t].trim()&&e.nameStarts===void 0&&!T(t)&&n[t]!=="/"&&!k(t)&&n[t]!=="!"&&(e.nameStarts=t,e.nameContainsLetters=!1,""+33+39+e.nameStarts)),e.nameStarts&&!e.quotes&&n[t].toLowerCase()!==n[t].toUpperCase()&&(e.nameContainsLetters=!0),k(t)&&q(e,n,t)&&!0&&e.lastOpeningBracketAt!==void 0&&(e.lastClosingBracketAt=t,""+`[${32}mSET[${39}m`+e.lastClosingBracketAt,B=null,Object.keys(l).length&&(""+`[${32}mPUSH[${39}m`+33+39,e.attributes.push(l),l={}),a.dumpLinkHrefsNearby.enabled&&d.tagName&&!d.openingTagEnds&&(d.openingTagEnds=t,""+`[${32}mSET[${39}m`+`[${33}mhrefDump[${39}m`+JSON.stringify(d,null,4))),e.lastOpeningBracketAt!==void 0){if(""+`[${33}mtag.lastClosingBracketAt[${39}m`+JSON.stringify(e.lastClosingBracketAt,null,4),e.lastClosingBracketAt===void 0){if(e.lastOpeningBracketAt<t&&!T(t)&&(n[t+1]===void 0||T(t+1))&&e.nameContainsLetters){if(""+n[t+1],e.name=n.slice(e.nameStarts,e.nameEnds?e.nameEnds:t+1).toLowerCase(),""+`[${32}mSET[${39}m`+`[${33}mtag.name[${39}m`+JSON.stringify(e.name,null,4),(!p.length||p[p.length-1][0]!==e.lastOpeningBracketAt)&&(p.push([e.lastOpeningBracketAt,t+1]),""+`[${32}mPUSH[${39}m`+e.lastOpeningBracketAt+(t+1)),a.ignoreTags.includes(e.name)||e.onlyPlausible&&!E.has(e.name)){""+31+39,e={},l={};continue}if((E.has(e.name)||A.has(e.name))&&(e.onlyPlausible===!1||e.onlyPlausible===!0&&e.attributes.length)||n[t+1]===void 0){w(a),""+`[${33}mstringToInsertAfter[${39}m`+JSON.stringify(f,null,4);let s=W(n,t,e.leftOuterWhitespace,t+1,e.lastOpeningBracketAt,e.lastClosingBracketAt);""+33+`cb()-PUSH: [${e.leftOuterWhitespace}, ${t+1}, "${s}${f}${s}"]`+39,""+`[${33}mtag[${39}m`+JSON.stringify(e,null,4),a.cb({tag:e,deleteFrom:e.leftOuterWhitespace,deleteTo:t+1,insert:`${s}${f}${s}`,rangesArr:g,proposedReturn:[e.leftOuterWhitespace,t+1,`${s}${f}${s}`]}),J(),R(t,a,g)}if(!u.length||u[u.length-1][0]!==e.lastOpeningBracketAt&&u[u.length-1][1]!==t+1)if(a.stripTogetherWithTheirContents.includes(e.name)||a.stripTogetherWithTheirContents.includes("*")){""+`[${33}mrangedOpeningTags[${39}m`+JSON.stringify(m,null,4);let s;for(let i=m.length;i--;)m[i].name===e.name&&(s=m[i],""+`[${32}mSET[${39}m`+`[${33}mlastRangedOpeningTag[${39}m`+JSON.stringify(s,null,4));s?(""+`[${33}mfilteredTagLocations[${39}m`+JSON.stringify(u,null,4),u=u.filter(([i])=>i!==s.lastOpeningBracketAt),""+`[${33}mfilteredTagLocations[${39}m`+JSON.stringify(u,null,4),u.push([s.lastOpeningBracketAt,t+1]),""+`[${32}mPUSH[${39}m`+s.lastOpeningBracketAt+(t+1)):(u.push([e.lastOpeningBracketAt,t+1]),""+`[${32}mPUSH[${39}m`+e.lastOpeningBracketAt+(t+1))}else u.push([e.lastOpeningBracketAt,t+1]),""+`[${32}mPUSH[${39}m`+e.lastOpeningBracketAt+(t+1)}}else if(t>e.lastClosingBracketAt&&n[t].trim()||n[t+1]===void 0){let s=e.lastClosingBracketAt===t?t+1:t;if(""+`[${33}mendingRangeIndex[${39}m`+JSON.stringify(s,null,4),a.trimOnlySpaces&&s===r-1&&B!==null&&B<t&&(s=B),""+`[${33}mtag.name[${39}m`+JSON.stringify(e.name,null,4),(!p.length||p[p.length-1][0]!==e.lastOpeningBracketAt)&&(p.push([e.lastOpeningBracketAt,e.lastClosingBracketAt+1]),""+`[${32}mPUSH[${39}m`+e.lastOpeningBracketAt+(e.lastClosingBracketAt+1)),!F&&a.ignoreTags.includes(e.name)||F&&!a.onlyStripTags.includes(e.name))a.cb({tag:e,deleteFrom:null,deleteTo:null,insert:null,rangesArr:g,proposedReturn:null}),""+31+39,e={},l={};else if(!e.onlyPlausible||e.attributes.length===0&&e.name&&(E.has(e.name.toLowerCase())||A.has(e.name.toLowerCase()))||e.attributes&&e.attributes.some(i=>i.equalsAt)){(!u.length||u[u.length-1][0]!==e.lastOpeningBracketAt)&&(u.push([e.lastOpeningBracketAt,e.lastClosingBracketAt+1]),""+`[${32}mPUSH[${39}m`+e.lastOpeningBracketAt+(e.lastClosingBracketAt+1));let i=W(n,t,e.leftOuterWhitespace,s,e.lastOpeningBracketAt,e.lastClosingBracketAt);""+`[${33}mwhiteSpaceCompensation[${39}m`+JSON.stringify(i,null,4)+i.length,f="",C=!1,w(a),""+`[${33}mstringToInsertAfter[${39}m`+JSON.stringify(f,null,4);let o;Y(f)&&f.length?(o=`${i}${f}${i===`

`?`
`:i}`,""+`[${32}mSET[${39}m`+`[${33}minsert[${39}m`+JSON.stringify(o,null,4)):(o=i,""+`[${32}mSET[${39}m`+`[${33}minsert[${39}m`+JSON.stringify(o,null,4)),(e.leftOuterWhitespace===0||!M(n,s-1))&&(o="",""+`[${32}mSET[${39}m`+`[${33}minsert[${39}m`+JSON.stringify(o,null,4)),""+33+`cb()-SUBMIT RANGE #2: [${e.leftOuterWhitespace}, ${s}, ${JSON.stringify(o,null,0)}]`+39,a.cb({tag:e,deleteFrom:e.leftOuterWhitespace,deleteTo:s,insert:o,rangesArr:g,proposedReturn:[e.leftOuterWhitespace,s,o]}),J(),R(t,a,g)}else""+33+39,e={};k(t)||(""+33+39,e={})}}if(T(t)&&!T(t-1)&&!`'"`.includes(n[t+1])&&(!`'"`.includes(n[t+2])||/\w/.test(n[t+1]))&&!(n[t+1]==="c"&&n[t+2]===":")&&!(n[t+1]==="f"&&n[t+2]==="m"&&n[t+3]==="t"&&n[t+4]===":")&&!(n[t+1]==="s"&&n[t+2]==="q"&&n[t+3]==="l"&&n[t+4]===":")&&!(n[t+1]==="x"&&n[t+2]===":")&&!(n[t+1]==="f"&&n[t+2]==="n"&&n[t+3]===":")&&q(e,n,t)){if(k(M(n,t)))continue;if(""+!!e.nameEnds+(e.nameEnds<t)+!e.lastClosingBracketAt,e.nameEnds&&e.nameEnds<t&&!e.lastClosingBracketAt&&(""+!!e.onlyPlausible+!E.has(e.name)+!A.has(e.name)+!(e.attributes&&e.attributes.length),e.onlyPlausible===!0&&e.attributes&&e.attributes.length||e.onlyPlausible===!1)){let s=W(n,t,e.leftOuterWhitespace,t,e.lastOpeningBracketAt,t);""+e.leftOuterWhitespace+t+s,a.cb({tag:e,deleteFrom:e.leftOuterWhitespace,deleteTo:t,insert:s,rangesArr:g,proposedReturn:[e.leftOuterWhitespace,t,s]}),R(t,a,g),e={},l={}}if(e.lastOpeningBracketAt!==void 0&&e.onlyPlausible&&e.name&&!e.quotes&&(""+`[${31}mRESET[${39}m`,e.lastOpeningBracketAt=void 0,e.name=void 0,e.onlyPlausible=!1,""+`[${33}mtag[${39}m`+JSON.stringify(e,null,4)),(e.lastOpeningBracketAt===void 0||!e.onlyPlausible)&&!e.quotes&&(e.lastOpeningBracketAt=t,e.slashPresent=!1,e.attributes=[],O===null?e.leftOuterWhitespace=t:a.trimOnlySpaces&&O===0?e.leftOuterWhitespace=N||t:e.leftOuterWhitespace=O,""+`[${32}mSET[${39}m`+33+39+e.leftOuterWhitespace+33+39+e.lastOpeningBracketAt+33+39,`${n[t+1]}${n[t+2]}${n[t+3]}`=="!--"||`${n[t+1]}${n[t+2]}${n[t+3]}${n[t+4]}${n[t+5]}${n[t+6]}${n[t+7]}${n[t+8]}`=="![CDATA[")){""+31+39;let s=!0;n[t+2]==="-"&&(s=!1);let i;for(let o=t;o<r;o++)if(""+`[${33}m${`str[${o}]`}[${39}m`+n[o],(!i&&s&&`${n[o-2]}${n[o-1]}${n[o]}`=="]]>"||!s&&`${n[o-2]}${n[o-1]}${n[o]}`=="-->")&&(i=o,""+i),i&&(i<o&&n[o].trim()||n[o+1]===void 0)){let c=o;(n[o+1]===void 0&&!n[o].trim()||n[o]===">")&&(c+=1),(!p.length||p[p.length-1][0]!==e.lastOpeningBracketAt)&&(p.push([e.lastOpeningBracketAt,i+1]),""+`[${32}mPUSH[${39}m`+e.lastOpeningBracketAt+(i+1)),(!u.length||u[u.length-1][0]!==e.lastOpeningBracketAt)&&(u.push([e.lastOpeningBracketAt,i+1]),""+`[${32}mPUSH[${39}m`+e.lastOpeningBracketAt+(i+1));let $=W(n,o,e.leftOuterWhitespace,c,e.lastOpeningBracketAt,i);""+e.leftOuterWhitespace+c+$,a.cb({tag:e,deleteFrom:e.leftOuterWhitespace,deleteTo:c,insert:$,rangesArr:g,proposedReturn:[e.leftOuterWhitespace,c,$]}),t=o-1,n[o]===">"&&(t=o),e={},l={};break}}}n[t].trim()?O!==null&&(!e.quotes&&l.equalsAt>O-1&&l.nameEnds&&l.equalsAt>l.nameEnds&&n[t]!=='"'&&n[t]!=="'"&&(L(l)&&(""+`[${33}mattrObj[${39}m`+JSON.stringify(l,null,4),e.attributes.push(l)),l={},e.equalsSpottedAt=void 0),O=null,""+`[${32}mSET[${39}m`+33+39+O):O===null&&(O=t,""+`[${32}mSET[${39}m`+33+39+O,e.lastOpeningBracketAt!==void 0&&e.lastOpeningBracketAt<t&&e.nameStarts&&e.nameStarts<e.lastOpeningBracketAt&&t===e.lastOpeningBracketAt+1&&!m.some(s=>s.name===e.name)&&(""+31+39,e.onlyPlausible=!0,e.name=void 0,e.nameStarts=void 0)),n[t]===" "?N===null&&(N=t,""+`[${32}mSET[${39}m`+33+39+N):N!==null&&(N=null,""+`[${32}mSET[${39}m`+33+39+N),""+32+39,""+`[${33}mrangedOpeningTags[${39}m`+JSON.stringify(m,null,4),""+`[${33}mfilteredTagLocations[${39}m`+JSON.stringify(u,null,4),""+`[${33}mspacesChunkWhichFollowsTheClosingBracketEndsAt[${39}m`+JSON.stringify(B,null,4),""+`[${33}mhrefDump[${39}m`+JSON.stringify(d,null,4),""+`[${33}mattrObj[${39}m`+JSON.stringify(l,null,4),""+(Object.keys(e).length?`${`[${35}mtag[${39}m`} = ${Object.keys(e).map(s=>`${`[${90}m${`[${7}m${s}[${27}m`}[${39}m`} ${`[${90}m: ${L(e[s])||Array.isArray(e[s])?JSON.stringify(e[s],null,4):e[s]}[${39}m`}`).join(`,
`)}
`:"")+(g.current()?`RANGES: ${JSON.stringify(g.current(),null,0)}`:"")}if(n&&(a.trimOnlySpaces&&n[0]===" "||!a.trimOnlySpaces&&!n[0].trim()))for(let t=0,r=n.length;t<r;t++)if(a.trimOnlySpaces&&n[t]!==" "||!a.trimOnlySpaces&&n[t].trim()){""+t,g.push([0,t]);break}else n[t+1]||(""+(t+1),g.push([0,t+1]));if(n&&(a.trimOnlySpaces&&n[n.length-1]===" "||!a.trimOnlySpaces&&!n[n.length-1].trim())){for(let t=n.length;t--;)if(a.trimOnlySpaces&&n[t]!==" "||!a.trimOnlySpaces&&n[t].trim()){""+n.length,g.push([t+1,n.length]);break}}let y=g.current();if((!b||!b.cb)&&y){if(y[0]&&!y[0][0]){""+`[${33}mthe first range[${39}m`+JSON.stringify(y[0],null,4);let t=y[0][1];""+`[${33}mstartingIdx[${39}m`+JSON.stringify(t,null,4),g.ranges[0]=[g.ranges[0][0],g.ranges[0][1]]}if(y[y.length-1]&&y[y.length-1][1]===n.length){""+`[${33}mthe last range[${39}m`+JSON.stringify(y[y.length-1],null,4)+n.length;let t=y[y.length-1][0];if(""+`[${33}mstartingIdx[${39}m`+JSON.stringify(t,null,4),g.ranges){let r=g.ranges[g.ranges.length-1][0];n[r-1]&&(a.trimOnlySpaces&&n[r-1]===" "||!a.trimOnlySpaces&&!n[r-1].trim())&&(r-=1);let s=g.ranges[g.ranges.length-1][2];g.ranges[g.ranges.length-1]=[r,g.ranges[g.ranges.length-1][1]],s&&s.trim()&&g.ranges[g.ranges.length-1].push(s.trimEnd())}}}let U={log:{timeTakenInMilliseconds:Date.now()-S},result:Q(n,g.current()),ranges:g.current(),allTagLocations:p,filteredTagLocations:u};return""+`[${32}mFINAL RESULT[${39}m`+JSON.stringify(U,null,4),U}export{v as defaults,X as stripHtml,be as version};

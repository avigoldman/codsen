/**
 * string-collapse-white-space
 * Replace chunks of whitespace with a single spaces
 * Version: 9.0.11
 * Author: Roy Revelt, Codsen Ltd
 * License: MIT
 * Homepage: https://codsen.com/os/string-collapse-white-space/
 */

import{rApply as t}from"ranges-apply";import{Ranges as n}from"ranges-push";import{right as e}from"string-left-right";const r="9.0.11",l={trimStart:!0,trimEnd:!0,trimLines:!1,trimnbsp:!1,removeEmptyLines:!1,limitConsecutiveEmptyLinesTo:0,enforceSpacesOnly:!1,cb:({suggested:t})=>t},i=["suggested","whiteSpaceStartsAt","whiteSpaceEndsAt","str"];function s(r,i){if("string"!=typeof r)throw new Error(`string-collapse-white-space/collapse(): [THROW_ID_01] The input is not string but ${typeof r}, equal to: ${JSON.stringify(r,null,4)}`);if(i&&"object"!=typeof i)throw new Error(`string-collapse-white-space/collapse(): [THROW_ID_02] The opts is not a plain object but ${typeof i}, equal to:\n${JSON.stringify(i,null,4)}`);if(!r.length)return{result:"",ranges:null};const s=new n,u="Â ",c={...l,...i};function p(t,n){if("function"==typeof c.cb){const e=c.cb({suggested:t,...n});Array.isArray(e)&&s.push(...e)}else t&&s.push(...t)}let a=null,o=null,m=null,f=null,S=null,h=!1;const g=[];let d=0;for(let t=0,n=r.length;t<=n;t++){if(("\r"===r[t]||"\n"===r[t]&&"\r"!==r[t-1])&&(d+=1,null===f&&(f=t),S="\r"===r[t]&&"\n"===r[t+1]?t+2:t+1),c.trimnbsp||r[t]!==u||h||(h=!0),null!==a&&" "!==r[t]){const n=a&&o||!o&&(!c.trimStart||!c.trimnbsp&&(r[t]===u||r[a-1]===u)),l=r[t]||!c.trimEnd||!c.trimnbsp&&(r[t]===u||r[a-1]===u),i=!c.enforceSpacesOnly||(!r[a-1]||r[a-1].trim())&&(!r[t]||r[t].trim());if(a<t-1&&n&&l&&i){const n=a;let l=t,i=" ";c.trimLines&&(!a||!r[t]||r[a-1]&&"\r\n".includes(r[a-1])||r[t]&&"\r\n".includes(r[t]))&&(i=null),i&&" "===r[a]&&(l-=1,i=null),(!a&&c.trimStart||!r[t]&&c.trimEnd)&&(l=t),g.push([i?[n,l,i]:[n,l],{whiteSpaceStartsAt:o,whiteSpaceEndsAt:e(r,t-1)||t,str:r}])}}if(null===a&&" "===r[t]&&(a=t),null===o&&r[t]&&!r[t].trim()&&(o=t),null!==m&&("\n\r".includes(r[t])||!r[t]||r[t].trim()||!c.trimnbsp&&!c.enforceSpacesOnly&&r[t]===u)&&(m||!c.trimStart||c.enforceSpacesOnly&&h)&&(r[t]||!c.trimEnd||c.enforceSpacesOnly&&h)){if(c.enforceSpacesOnly&&(t>m+1||" "!==r[m])){let n=m,e=t,l=" ";" "===r[e-1]?(e-=1,l=null):" "===r[m]&&(n+=1,l=null),((c.trimStart||c.trimLines)&&!m||(c.trimEnd||c.trimLines)&&!r[t])&&(l=null),p(l?[n,e,l]:[n,e],{whiteSpaceStartsAt:o,whiteSpaceEndsAt:t,str:r})}!c.trimLines||m&&!"\r\n".includes(r[m-1])&&r[t]&&!"\r\n".includes(r[t])||!c.trimnbsp&&h||p([m,t],{whiteSpaceStartsAt:o,whiteSpaceEndsAt:e(r,t-1)||t,str:r}),m=null}if(null!==m||"\r\n".includes(r[t])||!r[t]||r[t].trim()||!c.trimnbsp&&r[t]===u&&!c.enforceSpacesOnly||(m=t),null!==o&&(!r[t]||r[t].trim())){if((!o&&(c.trimStart||c.trimLines&&null===f)||!r[t]&&(c.trimEnd||c.trimLines&&null===f))&&(c.trimnbsp||!h||c.enforceSpacesOnly))p([o,t],{whiteSpaceStartsAt:o,whiteSpaceEndsAt:t,str:r});else{let n=!1;if(c.removeEmptyLines&&null!==f&&d>(c.limitConsecutiveEmptyLinesTo||0)+1){n=!0;let e=f,l=S||r.length,i=`${"\r"===r[f]&&"\n"===r[f+1]?"\r\n":r[f]}`.repeat((c.limitConsecutiveEmptyLinesTo||0)+1);r.endsWith(i,S)?(l-=i.length||0,i=null):r.startsWith(i,f)&&(e+=i.length,i=null),p(i?[e,l,i]:[e,l],{whiteSpaceStartsAt:o,whiteSpaceEndsAt:t,str:r})}if(g.length){for(;g.length;)p(...g.shift());n=!0}n||p(null,{whiteSpaceStartsAt:o,whiteSpaceEndsAt:t,str:r})}o=null,m=null,h=!1,d&&(d=0,f=null,S=null)}null!==a&&" "!==r[t]&&(a=null)}return{result:t(r,s.current()),ranges:s.current()}}export{i as cbSchema,s as collapse,l as defaults,r as version};

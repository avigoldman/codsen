/**
 * @name detergent
 * @fileoverview Extracts, cleans and encodes text
 * @version 7.0.12
 * @author Roy Revelt, Codsen Ltd
 * @license MIT
 * {@link https://codsen.com/os/detergent/}
 */

var fe=Object.create,M=Object.defineProperty,ge=Object.getPrototypeOf,Z=Object.prototype.hasOwnProperty,de=Object.getOwnPropertyNames,ve=Object.getOwnPropertyDescriptor,V=Object.getOwnPropertySymbols,Se=Object.prototype.propertyIsEnumerable;var y=(e,r,l)=>r in e?M(e,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[r]=l,R=(e,r)=>{for(var l in r||(r={}))Z.call(r,l)&&y(e,l,r[l]);if(V)for(var l of V(r))Se.call(r,l)&&y(e,l,r[l]);return e},ee=e=>M(e,"__esModule",{value:!0});var Ee=(e,r)=>{for(var l in r)M(e,l,{get:r[l],enumerable:!0})},Ce=(e,r,l)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of de(r))!Z.call(e,o)&&o!=="default"&&M(e,o,{get:()=>r[o],enumerable:!(l=ve(r,o))||l.enumerable});return e},g=e=>Ce(ee(M(e!=null?fe(ge(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);ee(exports);Ee(exports,{det:()=>Te,opts:()=>_,version:()=>je});var b=g(require("string-left-right")),ue=g(require("string-fix-broken-named-entities")),ie=g(require("string-remove-widows")),ae=g(require("ranges-process-outside")),G=g(require("string-collapse-white-space")),me=g(require("string-trim-spaces-only")),K=g(require("string-strip-html")),be=g(require("ranges-invert")),H=g(require("ranges-apply")),pe=g(require("ansi-regex")),Y=g(require("ranges-push")),he=g(require("he"));var oe="7.0.12";var N=g(require("html-entities-not-email-friendly")),re=g(require("all-named-html-entities")),$e=g(require("string-range-expander")),k=g(require("string-apostrophes")),U=g(require("he")),m=g(require("string-left-right"));var I=g(require("he")),_={fixBrokenEntities:!0,removeWidows:!0,convertEntities:!0,convertDashes:!0,convertApostrophes:!0,replaceLineBreaks:!0,removeLineBreaks:!1,useXHTML:!0,dontEncodeNonLatin:!0,addMissingSpaces:!0,convertDotsToEllipsis:!0,stripHtml:!0,eol:"lf",stripHtmlButIgnoreTags:["b","strong","i","em","br","sup"],stripHtmlAddNewLine:["li","/ul"],cb:null},x="\u2018",B="\u2019",O="\u201C",W="\u201D",q=[".",",",";","!","?"],se="\u2013",T="\u2014",L="\xA0",F="\u2026";var ne=/. ./g,Le=[[0,880],[887,890],[894,900],[906,908],[908,910],[929,931],[1319,1329],[1366,1369],[1375,1377],[1415,1417],[1418,1423],[1423,1425],[1479,1488],[1514,1520],[1524,1536],[1540,1542],[1563,1566],[1805,1807],[1866,1869],[1969,1984],[2042,2048],[2093,2096],[2110,2112],[2139,2142],[2142,2208],[2208,2210],[2220,2276],[2302,2304],[2423,2425],[2431,2433],[2435,2437],[2444,2447],[2448,2451],[2472,2474],[2480,2482],[2482,2486],[2489,2492],[2500,2503],[2504,2507],[2510,2519],[2519,2524],[2525,2527],[2531,2534],[2555,2561],[2563,2565],[2570,2575],[2576,2579],[2600,2602],[2608,2610],[2611,2613],[2614,2616],[2617,2620],[2620,2622],[2626,2631],[2632,2635],[2637,2641],[2641,2649],[2652,2654],[2654,2662],[2677,2689],[2691,2693],[2701,2703],[2705,2707],[2728,2730],[2736,2738],[2739,2741],[2745,2748],[2757,2759],[2761,2763],[2765,2768],[2768,2784],[2787,2790],[2801,2817],[2819,2821],[2828,2831],[2832,2835],[2856,2858],[2864,2866],[2867,2869],[2873,2876],[2884,2887],[2888,2891],[2893,2902],[2903,2908],[2909,2911],[2915,2918],[2935,2946],[2947,2949],[2954,2958],[2960,2962],[2965,2969],[2970,2972],[2972,2974],[2975,2979],[2980,2984],[2986,2990],[3001,3006],[3010,3014],[3016,3018],[3021,3024],[3024,3031],[3031,3046],[3066,3073],[3075,3077],[3084,3086],[3088,3090],[3112,3114],[3123,3125],[3129,3133],[3140,3142],[3144,3146],[3149,3157],[3158,3160],[3161,3168],[3171,3174],[3183,3192],[3199,3202],[3203,3205],[3212,3214],[3216,3218],[3240,3242],[3251,3253],[3257,3260],[3268,3270],[3272,3274],[3277,3285],[3286,3294],[3294,3296],[3299,3302],[3311,3313],[3314,3330],[3331,3333],[3340,3342],[3344,3346],[3386,3389],[3396,3398],[3400,3402],[3406,3415],[3415,3424],[3427,3430],[3445,3449],[3455,3458],[3459,3461],[3478,3482],[3505,3507],[3515,3517],[3517,3520],[3526,3530],[3530,3535],[3540,3542],[3542,3544],[3551,3570],[3572,3585],[3642,3647],[3675,3713],[3714,3716],[3716,3719],[3720,3722],[3722,3725],[3725,3732],[3735,3737],[3743,3745],[3747,3749],[3749,3751],[3751,3754],[3755,3757],[3769,3771],[3773,3776],[3780,3782],[3782,3784],[3789,3792],[3801,3804],[3807,3840],[3911,3913],[3948,3953],[3991,3993],[4028,4030],[4044,4046],[4058,4096],[4293,4295],[4295,4301],[4301,4304],[4680,4682],[4685,4688],[4694,4696],[4696,4698],[4701,4704],[4744,4746],[4749,4752],[4784,4786],[4789,4792],[4798,4800],[4800,4802],[4805,4808],[4822,4824],[4880,4882],[4885,4888],[4954,4957],[4988,4992],[5017,5024],[5108,5120],[5788,5792],[5872,5888],[5900,5902],[5908,5920],[5942,5952],[5971,5984],[5996,5998],[6e3,6002],[6003,6016],[6109,6112],[6121,6128],[6137,6144],[6158,6160],[6169,6176],[6263,6272],[6314,7936],[7957,7960],[7965,7968],[8005,8008],[8013,8016],[8023,8025],[8025,8027],[8027,8029],[8029,8031],[8061,8064],[8116,8118],[8132,8134],[8147,8150],[8155,8157],[8175,8178],[8180,8182],[8190,11904],[11929,11931],[12019,12032],[12245,12288],[12351,12353],[12438,12441],[12543,12549],[12589,12593],[12686,12688],[12730,12736],[12771,12784],[12830,12832],[13054,13056],[13312,19893],[19893,19904],[40869,40908],[40908,40960],[42124,42128],[42182,42192],[42539,42560],[42647,42655],[42743,42752],[42894,42896],[42899,42912],[42922,43e3],[43051,43056],[43065,43072],[43127,43136],[43204,43214],[43225,43232],[43259,43264],[43347,43359],[43388,43392],[43469,43471],[43481,43486],[43487,43520],[43574,43584],[43597,43600],[43609,43612],[43643,43648],[43714,43739],[43766,43777],[43782,43785],[43790,43793],[43798,43808],[43814,43816],[43822,43968],[44013,44016],[44025,44032],[55203,55216],[55238,55243],[55291,63744],[64109,64112],[64217,64256],[64262,64275],[64279,64285],[64310,64312],[64316,64318],[64318,64320],[64321,64323],[64324,64326],[64449,64467],[64831,64848],[64911,64914],[64967,65008],[65021,65136],[65140,65142],[65276,66560],[66717,66720],[66729,67584],[67589,67592],[67592,67594],[67637,67639],[67640,67644],[67644,67647],[67669,67671],[67679,67840],[67867,67871],[67897,67903],[67903,67968],[68023,68030],[68031,68096],[68099,68101],[68102,68108],[68115,68117],[68119,68121],[68147,68152],[68154,68159],[68167,68176],[68184,68192],[68223,68352],[68405,68409],[68437,68440],[68466,68472],[68479,68608],[68680,69216],[69246,69632],[69709,69714],[69743,69760],[69825,69840],[69864,69872],[69881,69888],[69940,69942],[69955,70016],[70088,70096],[70105,71296],[71351,71360],[71369,73728],[74606,74752],[74850,74864],[74867,77824],[78894,92160],[92728,93952],[94020,94032],[94078,94095],[94111,110592],[110593,131072],[131072,173782],[173782,173824],[173824,177972],[177972,177984],[177984,178205],[178205,194560]],Q=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];function w(e,r){return r?Array.from(e).map(l=>l.charCodeAt(0)<880||Le.some(o=>l.charCodeAt(0)>o[0]&&l.charCodeAt(0)<o[1])?I.default.encode(l,{useNamedReferences:!0}):l).join(""):I.default.encode(e,{useNamedReferences:!0})}function f(e){return typeof e=="string"&&e.charCodeAt(0)>=48&&e.charCodeAt(0)<=57||Number.isInteger(e)}function j(e){return typeof e=="string"&&e.length===1&&e.toUpperCase()!==e.toLowerCase()}function te(e){return e==='"'||e==="'"||e===x||e===B||e===O||e===W}function P(e){return j(e)?e===e.toLowerCase()&&e!==e.toUpperCase():!1}function z(e){return j(e)?e===e.toUpperCase()&&e!==e.toLowerCase():!1}function le(e){return typeof e=="string"&&e.length&&e.endsWith("/")?e.slice(0,-1).trim():e}function ce(e,r,l,o,s,d,a,v,t,h){let D=e.length;if(""+36+39+35+`str[i] at ${o} = ${e[o].trim()?e.slice(o,s):JSON.stringify(e[o],null,0)}`+39+`[${90}m (${e.slice(o,s).split("").map(u=>`#${u.charCodeAt(0)}`).join("; ")}); i = ${o}; y = ${s}[${39}m`+36+39,""+`[${90}m${`state = ${JSON.stringify(v,null,4)}`}[${39}m`,/[\uD800-\uDFFF]/g.test(e[o])&&!(e.charCodeAt(o+1)>=56320&&e.charCodeAt(o+1)<=57343||e.charCodeAt(o-1)>=55296&&e.charCodeAt(o-1)<=56319))l.push(o,o+1),""+`[${32}mPUSH[${39}m`+o+(o+1);else if(s-o>1)t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,t.dontEncodeNonLatin=t.dontEncodeNonLatin||w(e.slice(o,s),!0)!==w(e.slice(o,s),!1),""+`[${32}mSET[${39}m`+t.dontEncodeNonLatin,r.convertEntities&&l.push(o,s,w(e.slice(o,s),r.dontEncodeNonLatin));else{let u=e[o].charCodeAt(0);if(u<127){if(""+`[${90}mcharacter within ASCII[${39}m`,u<32)if(u<9)u===3?(""+`[${32}mPUSH[${39}m`+o+s+(r.removeLineBreaks?" ":"\\n"),l.push(o,s,r.removeLineBreaks?" ":r.replaceLineBreaks?`<br${r.useXHTML?"/":""}>
`:`
`),t.removeLineBreaks=!0,""+`[${32}mSET[${39}m`+t.removeLineBreaks,r.removeLineBreaks||(t.replaceLineBreaks=!0,""+`[${32}mSET[${39}m`+t.replaceLineBreaks,r.replaceLineBreaks&&(t.useXHTML=!0,""+`[${32}mSET[${39}m`+t.useXHTML))):(""+`[${32}mPUSH[${39}m`+o+s,l.push(o,s));else if(u===9)""+`[${32}mPUSH[${39}m`+o+s,l.push(o,s," ");else if(u===10){if(t.removeLineBreaks||(t.removeLineBreaks=!0,""+`[${32}mapplicableOpts.removeLineBreaks[${39}m`+t.removeLineBreaks),!r.removeLineBreaks&&(!a||Array.isArray(a)&&!a.some($=>(0,m.left)(e,o)===$))&&(r.replaceLineBreaks?(t.useXHTML=!0,t.replaceLineBreaks=!0,""+`[${32}mapplicableOpts.useXHTML[${39}m`+t.useXHTML+`[${32}mapplicableOpts.replaceLineBreaks[${39}m`+t.replaceLineBreaks):r.replaceLineBreaks||(t.replaceLineBreaks=!0,""+`[${32}mapplicableOpts.replaceLineBreaks[${39}m`+t.replaceLineBreaks)),r.removeLineBreaks||(t.eol=!0,""+`[${32}mapplicableOpts.eol[${39}m`+t.eol),r.removeLineBreaks){let $=" ";q.includes(e[(0,m.right)(e,o)])&&($=""),""+`[${32}mPUSH[${39}m`+o+s+JSON.stringify($,null,0),l.push(o,s,$)}else if(r.replaceLineBreaks&&(!a||Array.isArray(a)&&!a.some($=>(0,m.left)(e,o)===$))){let $=o;e[o-1]===" "&&typeof(0,m.leftStopAtNewLines)(e,o)=="number"&&($=(0,m.leftStopAtNewLines)(e,o)+1),l.push($,o+(h==="\r"?1:0),`<br${r.useXHTML?"/":""}>${h===`\r
`?"\r":""}${h==="\r"?"\r":""}`),""+`[${32}mPUSH[${39}m`+$+(o+(h==="\r"?1:0))+`<br${r.useXHTML?"/":""}>${JSON.stringify(h===`\r
`?"\r":"",null,4)}${JSON.stringify(h==="\r"?"\r":"",null,4)}`}else{if(e[(0,m.leftStopAtNewLines)(e,o)]&&e[(0,m.leftStopAtNewLines)(e,o)].trim()){let i=(0,m.leftStopAtNewLines)(e,o);typeof i=="number"&&i<o-1&&(""+`[${32}mPUSH[${39}m`+(i+1)+o,l.push(i+1,o,`${h===`\r
`?"\r":""}`))}h===`\r
`&&e[o-1]!=="\r"?(l.push(o,o,"\r"),""+`[${32}mPUSH[${39}m`+o+o):h==="\r"&&(l.push(o,o+1),""+`[${32}mPUSH[${39}m`+o+(o+1));let $=(0,m.rightStopAtNewLines)(e,o);$&&e[$].trim()&&$>o+1&&(""+`[${32}mPUSH[${39}m`+(o+1)+$,l.push(o+1,$))}v.onUrlCurrently=!1,""+`[${33}mstate.onUrlCurrently[${39}m`}else if(u===11||u===12)t.removeLineBreaks=!0,""+`[${32}mSET[${39}m`+t.removeLineBreaks,l.push(o,s,r.removeLineBreaks?" ":`
`),""+`[${32}mPUSH[${39}m`+o+s+(r.removeLineBreaks?" ":"\\n");else if(u===13)if(t.removeLineBreaks||(t.removeLineBreaks=!0,""+`[${32}mapplicableOpts.removeLineBreaks[${39}m`+t.removeLineBreaks),!r.removeLineBreaks&&(!a||Array.isArray(a)&&!a.some($=>(0,m.left)(e,o)===$))&&(r.replaceLineBreaks&&!r.removeLineBreaks?(t.useXHTML=!0,t.replaceLineBreaks=!0,""+`[${32}mapplicableOpts.useXHTML[${39}m`+t.useXHTML+`[${32}mapplicableOpts.replaceLineBreaks[${39}m`+t.replaceLineBreaks):r.replaceLineBreaks||(t.replaceLineBreaks=!0,""+`[${32}mapplicableOpts.replaceLineBreaks[${39}m`+t.replaceLineBreaks)),r.removeLineBreaks||(t.eol=!0,""+`[${32}mapplicableOpts.eol[${39}m`+t.eol),r.removeLineBreaks){let $=" ";(q.includes(e[(0,m.right)(e,o)])||[`
`,"\r"].includes(e[o+1]))&&($=""),l.push(o,s,$),""+`[${32}mPUSH[${39}m`+o+s+JSON.stringify($,null,0)}else if(r.replaceLineBreaks&&(!a||Array.isArray(a)&&!a.some($=>(0,m.left)(e,o)===$))){let $=o;e[o-1]===" "&&typeof(0,m.leftStopAtNewLines)(e,o)=="number"&&($=(0,m.leftStopAtNewLines)(e,o)+1);let i=o,p="";e[o+1]!==`
`&&(h===`
`?p=`
`:h===`\r
`&&(l.push(o+1,o+1,`
`),""+`[${32}mPUSH[${39}m`+(o+1)+(o+1))),h===`
`?i=o+1:h==="\r"&&e[o+1]===`
`&&(l.push(o+1,o+2),""+`[${32}mPUSH[${39}m`+(o+1)+(o+2)),l.push($,i,`<br${r.useXHTML?"/":""}>${p}`),""+`[${32}mPUSH[${39}m`+$+i+JSON.stringify(p,null,4),e[o+1]===`
`&&d(1)}else{h===`
`?(l.push(o,o+1,e[o+1]===`
`?"":`
`),""+o+(o+1)+JSON.stringify(e[o+1]===`
`?"":`
`,null,0)):h==="\r"&&e[o+1]===`
`?(l.push(o+1,o+2),""+(o+1)+(o+2)):h===`\r
`&&e[o+1]!==`
`&&(l.push(o,o+1,`
`),""+o+(o+1));let $=(0,m.leftStopAtNewLines)(e,o);if(typeof $=="number"&&e[$].trim()){let p=o;h===`
`&&(p=o+1),$<o-1&&(""+`[${32}mPUSH[${39}m`+($+1)+p+JSON.stringify(`${e[o+1]===`
`?"":`
`}`,null,4),l.push($+1,p,`${e[o+1]===`
`?"":`
`}`))}let i=(0,m.rightStopAtNewLines)(e,o);i&&e[i].trim()&&e[o+1]!==`
`&&i>o+1&&(""+`[${32}mPUSH[${39}m`+(o+1)+i,l.push(o+1,i))}else u>13&&(l.push(o,s),""+`[${32}mPUSH[${39}m`+o+s);else if(u!==32){if(u===34){t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,(f((0,m.left)(e,o))||f((0,m.right)(e,o)))&&(t.convertApostrophes=!0,""+`[${32}mSET[${39}m`+t.convertApostrophes);let $=(0,k.convertOne)(e,{from:o,convertEntities:r.convertEntities,convertApostrophes:r.convertApostrophes,offsetBy:d});""+`[${33}mtempRes[${39}m`+JSON.stringify($,null,4),$&&$.length?l.push($):r.convertEntities&&l.push(o,o+1,"&quot;")}else if(u===38)if(j(e[o+1])){let $=Object.keys(re.allNamedEntities).find(i=>e.startsWith(i,o+1)&&e[o+i.length+1]===";");if(""+`[${33}mtemp[${39}m`+JSON.stringify($,null,4),t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,$)if(""+`[${32}m${$}[${39}m`,$==="apos"){t.convertApostrophes=!0,""+`[${32}mSET[${39}m`+t.convertApostrophes;let i=(0,k.convertOne)(e,{from:o,to:o+$.length+2,value:"'",convertEntities:r.convertEntities,convertApostrophes:r.convertApostrophes,offsetBy:d});Array.isArray(i)&&i.length?(l.push(i),""+`[${32}mPUSH[${39}m`+JSON.stringify(i,null,0),""+($.length+2),d($.length+2)):(l.push([o,o+$.length+2,"'"]),""+`[${32}mPUSH[${39}m`+JSON.stringify([o,o+$.length+2,"'"],null,0),""+($.length+2),d($.length+2))}else r.convertEntities&&Object.keys(N.notEmailFriendly).includes(e.slice(o+1,o+$.length+1))?(l.push(o,o+$.length+2,`&${N.notEmailFriendly[e.slice(o+1,o+$.length+1)]};`),""+`[${32}mPUSH[${39}m`+o+(o+$.length+2)+JSON.stringify(N.notEmailFriendly[e.slice(o+1,o+$.length+1)],null,4),d($.length+1),""+($.length+1)):r.convertEntities?(d($.length+1),""+($.length+1)):(""+JSON.stringify(e.slice(o,o+$.length+2),null,4)+U.default.decode(`${e.slice(o,o+$.length+2)}`).charCodeAt(0),""+`[${32}mPUSH[${39}m`+o+(o+$.length+2)+JSON.stringify(U.default.decode(`${e.slice(o,o+$.length+2)}`),null,4),l.push(o,o+$.length+2,U.default.decode(`${e.slice(o,o+$.length+2)}`)),d($.length+1),""+($.length+1));else r.convertEntities&&(l.push(o,o+1,"&amp;"),""+`[${32}mPUSH[${39}m`+o+(o+1))}else if(e[(0,m.right)(e,o)]==="#"){for(let $=(0,m.right)(e,o);$<D;$++)if(e[$].trim()&&!f(e[$])&&e[$]!=="#"&&e[$]===";"){""+e.slice(o,$+1);let i=U.default.encode(U.default.decode(e.slice(o,$+1)),{useNamedReferences:!0});""+`[${33}mtempRes[${39}m`+JSON.stringify(i,null,4),i&&(l.push(o,$+1,i),""+`[${32}mPUSH[${39}m`+o+($+1)+i),d($+1-o),""+($+1-o)}}else t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,r.convertEntities&&(l.push(o,o+1,"&amp;"),""+`[${32}mPUSH[${39}m`+o+(o+1));else if(u===39){let $=(0,k.convertOne)(e,{from:o,convertEntities:!0,convertApostrophes:!0});$&&$.length&&(t.convertApostrophes=!0,""+`[${32}mSET[${39}m`+t.convertApostrophes,r.convertApostrophes&&(t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities),l.push((0,k.convertOne)(e,{from:o,convertEntities:r.convertEntities,convertApostrophes:r.convertApostrophes,offsetBy:d})))}else if(u===44||u===59){if(e[o-1]&&!e[o-1].trim()){let $=(0,m.left)(e,o);typeof $=="number"&&$<o-1&&(l.push($+1,o),""+`[${32}mPUSH[${39}m`+($+1)+o)}u===44&&e[s]!==void 0&&!v.onUrlCurrently&&!f(e[s])&&e[s].trim()&&e[s]!==" "&&e[s]!==`
`&&e[s]!=='"'&&e[s]!=="'"&&e[s]!==x&&e[s]!==O&&e[s]!==B&&e[s]!==W&&(t.addMissingSpaces=!0,""+`[${32}mSET[${39}m`+t.addMissingSpaces,r.addMissingSpaces&&(l.push(s,s," "),""+`[${32}mPUSH[${39}m`+s+s)),u===59&&e[s]!==void 0&&!v.onUrlCurrently&&e[s].trim()&&e[s]!=="&"&&e[s]!=='"'&&e[s]!=="'"&&e[s]!==x&&e[s]!==O&&e[s]!==B&&e[s]!==W&&(t.addMissingSpaces=!0,""+`[${32}mSET[${39}m`+t.addMissingSpaces,r.addMissingSpaces&&(l.push(s,s," "),""+`[${32}mPUSH[${39}m`+s+s))}else if(u===45)e[o-1]===" "&&e[s]===" "&&f(e[(0,m.left)(e,o)])&&f(e[(0,m.right)(e,s)])||((e[o-1]===L||e[o-1]===" ")&&e[s]!=="$"&&e[s]!=="\xA3"&&e[s]!=="\u20AC"&&e[s]!=="\u20BD"&&e[s]!=="0"&&e[s]!=="1"&&e[s]!=="2"&&e[s]!=="3"&&e[s]!=="4"&&e[s]!=="5"&&e[s]!=="6"&&e[s]!=="7"&&e[s]!=="8"&&e[s]!=="9"&&e[s]!=="-"&&e[s]!==">"&&e[s]!==" "?(t.addMissingSpaces=!0,""+`[${32}mSET[${39}m`+t.addMissingSpaces,r.addMissingSpaces&&(l.push(s,s," "),""+`[${32}mPUSH[${39}m`+s+s)):e[o-1]&&e[s]&&(f(e[o-1])&&f(e[s])||e[o-1].toLowerCase()==="a"&&e[s].toLowerCase()==="z")?(t.convertDashes=!0,""+`[${32}mSET[${39}m`+t.convertDashes,r.convertDashes&&(t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,""+`[${32}mPUSH[${39}m`+o+s+(r.convertEntities?"&ndash;":"\u2013"),l.push(o,s,r.convertEntities?"&ndash;":"\u2013"))):e[o-1]&&e[s]&&(!e[o-1].trim()&&!e[s].trim()||P(e[o-1])&&e[s]==="'")?(t.convertDashes=!0,""+`[${32}mSET[${39}m`+t.convertDashes,r.convertDashes&&(t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,""+`[${32}mPUSH[${39}m`+o+s+(r.convertEntities?"&mdash;":T),l.push(o,s,r.convertEntities?"&mdash;":T))):e[o-1]&&e[s]&&j(e[o-1])&&te(e[s])&&(t.convertDashes=!0,""+`[${32}mSET[${39}m`+t.convertDashes,r.convertDashes&&(t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,""+`[${32}mPUSH[${39}m`+o+s+(r.convertEntities?"&mdash;":T),l.push(o,s,r.convertEntities?"&mdash;":T)))),e[o-2]&&e[o-2].trim()&&!e[o-1].trim()&&![`
`,"\r"].includes(e[o-1])&&(t.removeWidows=!0,""+`[${32}mSET[${39}m`+`[${33}mapplicableOpts.removeWidows[${39}m`+t.removeWidows,r.removeWidows&&(t.convertEntities=!0,""+`[${32}mSET[${39}m`+`[${33}mapplicableOpts.convertEntities[${39}m`+t.convertEntities,l.push(o-1,o,r.convertEntities?"&nbsp;":L),""+`[${32}mPUSH[${39}m`+(o-1)+o+(r.convertEntities?"&nbsp;":L)));else if(u===46){e[o-1]!=="."&&e[s]==="."&&e[s+1]==="."&&e[s+2]!=="."&&(t.convertDotsToEllipsis=!0,""+`[${32}mSET[${39}m`+t.convertDotsToEllipsis,r.convertDotsToEllipsis&&(t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,""+`[${32}mPUSH[${39}m`+o+(s+2)+(r.convertEntities?"&hellip;":`${F}`),l.push(o,s+2,r.convertEntities?"&hellip;":`${F}`)));let $=e[s]?e[s].toLowerCase():"",i=e[s+1]?e[s+1].toLowerCase():"",p=e[s+2]?e[s+2].toLowerCase():"",c=e[s+3]?e[s+3].toLowerCase():"",n=$+i+p;if($+i!=="js"&&n!=="jpg"&&n!=="png"&&n!=="gif"&&n!=="svg"&&n!=="htm"&&n!=="pdf"&&n!=="psd"&&n!=="tar"&&n!=="zip"&&n!=="rar"&&n!=="otf"&&n!=="ttf"&&n!=="eot"&&n!=="php"&&n!=="rss"&&n!=="asp"&&n!=="ppt"&&n!=="doc"&&n!=="txt"&&n!=="rtf"&&n!=="git"&&n+c!=="jpeg"&&n+c!=="html"&&n+c!=="woff"&&!(!j(e[o-2])&&e[o-1]==="p"&&e[s]==="s"&&e[s+1]==="t"&&!j(e[s+2]))&&(e[s]!==void 0&&(!v.onUrlCurrently&&z(e[s])||v.onUrlCurrently&&j(e[s])&&z(e[s])&&j(e[s+1])&&P(e[s+1]))&&e[s]!==" "&&e[s]!=="."&&e[s]!==`
`&&(t.addMissingSpaces=!0,""+`[${32}mSET[${39}m`+t.addMissingSpaces,r.addMissingSpaces&&(l.push(s,s," "),""+`[${32}mPUSH[${39}m`+s+s)),e[o-1]!==void 0&&e[o-1].trim()===""&&e[s]!=="."&&(e[o-2]===void 0||e[o-2]!=="."))){for(s=o-1;s--;)if(e[s].trim()!==""){l.push(s+1,o),""+`[${32}mPUSH[${39}m`+(s+1)+o;break}}}else if(u!==47){if(u===58)e[s-1]&&e[(0,m.right)(e,s-1)]==="/"&&e[(0,m.right)(e,(0,m.right)(e,s-1))]==="/"&&(v.onUrlCurrently=!0,""+`[${32}mSET[${39}m`+`[${33}mstate.onUrlCurrently[${39}m`);else if(u===60)t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,r.convertEntities&&(l.push(o,o+1,"&lt;"),""+`[${32}mPUSH[${39}m`+o+(o+1));else if(u===62)t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,r.convertEntities&&(l.push(o,o+1,"&gt;"),""+`[${32}mPUSH[${39}m`+o+(o+1));else if(u===119)e[s+1]&&e[s].toLowerCase()==="w"&&e[s+1].toLowerCase()==="w"&&(v.onUrlCurrently=!0,""+`[${33}mstate.onUrlCurrently[${39}m`);else if(u===123){let $;if(e[s]==="{"?$="}}":e[s]==="%"&&($="%}"),$){""+$;for(let i=o;i<D;i++)if(""+e[i],e[i]===$[0]&&e[i+1]===$[1]){""+(i+1-o),d(i+1-o);break}}}}}}else if(""+`[${90}mcharacter outside ASCII[${39}m`+u,u>126&&u<160)u!==133?(l.push(o,s),""+`[${32}mPUSH[${39}m`+o+s):(t.removeLineBreaks=!0,""+`[${32}mSET[${39}m`+t.removeLineBreaks,l.push(o,s,r.removeLineBreaks?"":`
`),""+`[${32}mPUSH[${39}m`+o+s+(r.removeLineBreaks?"":"\\n"));else if(u===160)if(r.removeWidows)t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,t.removeWidows=!0,""+`[${32}mSET[${39}m`+t.removeWidows,r.convertEntities&&(""+`[${32}mPUSH[${39}m`+o+s,l.push(o,s,"&nbsp;"));else{let $=o,i=s,p=" ",c=(0,m.left)(e,o);""+`[${32}mSET[${39}m`+`[${33}mcharOnTheLeft[${39}m`+JSON.stringify(c,null,4);let n=(0,m.right)(e,i-1);""+`[${32}mSET[${39}m`+`[${33}mcharOnTheRight[${39}m`+JSON.stringify(n,null,4),c===null||n===null?(p=r.convertEntities?"&nbsp;":L,""+`[${32}mSET[${39}m`+`[${33}mcalculatedValue[${39}m`+JSON.stringify(p,null,4),t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities):(t.removeWidows=!0,""+`[${32}mSET[${39}m`+t.removeWidows),p?(l.push($,i,p),""+`[${32}mPUSH[${39}m`+$+i+JSON.stringify(p,null,4)+p.charCodeAt(0)):(l.push($,i),""+`[${32}mPUSH[${39}m`+$+i)}else if(u===173)l.push(o,s),""+`[${32}mPUSH[${39}m`+o+s;else if(u===8232||u===8233)t.removeLineBreaks=!0,""+`[${32}mSET[${39}m`+t.removeLineBreaks,l.push(o,s,r.removeLineBreaks?"":`
`),""+`[${32}mPUSH[${39}m`+o+s+(r.removeLineBreaks?"":"\\n");else if([5760,8191,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288].includes(u))if(!e[s])l.push(o,s),""+`[${32}mPUSH[${39}m`+o+s;else{let $=(0,$e.expander)({str:e,from:o,to:s,wipeAllWhitespaceOnLeft:!0,wipeAllWhitespaceOnRight:!0,addSingleSpaceToPreventAccidentalConcatenation:!0});""+JSON.stringify($,null,0),l.push(...$)}else if(u===8206)l.push(o,s),""+`[${32}mPUSH[${39}m`+o+s;else if(u===8207)l.push(o,s),""+`[${32}mPUSH[${39}m`+o+s;else if(u===8211||u===65533&&f(e[o-1])&&f(e[s])){if(t.convertDashes=!0,""+`[${32}mSET[${39}m`+t.convertDashes,r.convertDashes?(t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,r.convertEntities?e[o-1]&&!e[o-1].trim()&&e[o+1]&&!e[o+1].trim()&&!(f(e[o-2])&&f(e[o+2]))?(l.push(o,s,"&mdash;"),""+`[${32}mPUSH[${39}m`+o+s):(l.push(o,s,"&ndash;"),""+`[${32}mPUSH[${39}m`+o+s):u===65533&&(e[o-1]&&!e[o-1].trim()&&e[o+1]&&!e[o+1].trim()?(l.push(o,s,T),""+`[${32}mPUSH[${39}m`+o+s):(l.push(o,s,se),""+`[${32}mPUSH[${39}m`+o+s))):(l.push(o,s,"-"),""+`[${32}mPUSH[${39}m`+o+s),e[o-1]&&!e[o-1].trim()&&e[s].trim())if(e[o-2]&&f(e[o-2])&&f(e[s]))l.push(o-1,o),""+`[${32}mPUSH[${39}m`+(o-1)+o;else{if(t.addMissingSpaces=!0,""+`[${32}mSET[${39}m`+t.addMissingSpaces,t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,r.addMissingSpaces){let $=" ";ne.test(e.slice(s))||(t.removeWidows=!0,""+`[${32}mSET[${39}m`+t.removeWidows,r.removeWidows&&($=r.convertEntities?"&nbsp;":L,""+`[${32}mSET[${39}m`+(r.convertEntities?$:"rawNbsp"))),l.push(s,s,$),""+`[${32}mPUSH[${39}m`+s+s+JSON.stringify($,null,0)}e.slice(o-1,o)!==L&&(t.removeWidows=!0,""+`[${32}mSET[${39}m`+t.removeWidows,r.removeWidows&&(l.push(o-1,o,r.convertEntities?"&nbsp;":L),""+`[${32}mPUSH[${39}m`+(o-1)+o+JSON.stringify(r.convertEntities?"&nbsp;":L,null,0)))}else e[o-2]&&e[o-1]&&e[s]&&e[s+1]&&f(e[o-2])&&f(e[s+1])&&!e[o-1].trim()&&!e[s].trim()&&(l.push(o-1,o),l.push(s,s+1),""+`[${32}mPUSH[${39}m`+(o-1)+o+s+(s+1));e[o-2]&&e[o+1]&&!e[o-1].trim()&&e[o-2].trim()&&!e[o+1].trim()&&!(f(e[o-2])&&f(e[o+2]))&&(t.removeWidows=!0,r.removeWidows&&(l.push(o-1,o,r.convertEntities?"&nbsp;":L),""+`[${32}mPUSH[${39}m`+(o-1)+o+JSON.stringify(r.convertEntities?"&nbsp;":L,null,4)))}else if(u===8212||u===65533&&e[o-1]===" "&&e[s]===" ")t.convertDashes=!0,""+`[${32}mSET[${39}m`+t.convertDashes,e[o-1]===" "&&(0,m.left)(e,o)!==null&&(t.removeWidows=!0,""+`[${32}mSET[${39}m`+t.removeWidows,r.removeWidows&&(t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,typeof(0,m.left)(e,o)=="number"&&(l.push((0,m.left)(e,o)+1,o,r.convertEntities?"&nbsp;":L),""+`[${32}mPUSH[${39}m`+((0,m.left)(e,o)+1)+o+JSON.stringify(r.convertEntities?"&nbsp;":L,null,4)+L.charCodeAt(0)))),r.convertDashes?(t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,e[o-1]&&!e[o-1].trim()&&e[s].trim()&&(t.addMissingSpaces=!0,""+`[${32}mSET[${39}m`+t.addMissingSpaces,r.addMissingSpaces&&(l.push(s,s," "),""+`[${32}mPUSH[${39}m`+s+s)),r.convertEntities?(l.push(o,s,"&mdash;"),""+`[${32}mPUSH[${39}m`+o+s):u===65533&&(l.push(o,s,T),""+`[${32}mPUSH[${39}m`+o+s),""+`[${33}mrangesArr.current()[${39}m`+JSON.stringify(l.current(),null,4)):(l.push(o,s,"-"),""+`[${32}mPUSH[${39}m`+o+s);else if(u===8216){let $=(0,k.convertOne)(e,{from:o,to:s,convertEntities:!0,convertApostrophes:!0});$&&$.length&&(t.convertApostrophes=!0,""+`[${32}mSET[${39}m`+t.convertApostrophes,(0,k.convertOne)(e,{from:o,to:s,convertEntities:!0,convertApostrophes:!0})&&(r.convertApostrophes&&(t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities),l.push((0,k.convertOne)(e,{from:o,to:s,convertEntities:r.convertEntities,convertApostrophes:r.convertApostrophes,offsetBy:d}))))}else if(u===8217)t.convertApostrophes=!0,""+`[${32}mSET[${39}m`+t.convertApostrophes,r.convertApostrophes?(t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,r.convertEntities&&(l.push(o,s,"&rsquo;"),""+`[${32}mPUSH[${39}m`+o+s)):(l.push(o,s,"'"),""+`[${32}mPUSH[${39}m`+o+s);else if(u===8220)t.convertApostrophes=!0,""+`[${32}mSET[${39}m`+t.convertApostrophes,r.convertApostrophes?r.convertEntities&&(t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,l.push(o,s,"&ldquo;"),""+`[${32}mPUSH[${39}m`+o+s):(t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,l.push(o,s,r.convertEntities?"&quot;":'"'),""+`[${32}mPUSH[${39}m`+o+s+JSON.stringify(r.convertEntities?"&quot;":'"',null,0));else if(u===8221)t.convertApostrophes=!0,""+`[${32}mSET[${39}m`+t.convertApostrophes,r.convertApostrophes?r.convertEntities&&(t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,l.push(o,s,"&rdquo;"),""+`[${32}mPUSH[${39}m`+o+s):(t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,l.push(o,s,r.convertEntities?"&quot;":'"'),""+`[${32}mPUSH[${39}m`+o+s+JSON.stringify(r.convertEntities?"&quot;":'"',null,0));else if(u===8230)t.convertDotsToEllipsis=!0,""+`[${32}mSET[${39}m`+t.convertDotsToEllipsis,r.convertDotsToEllipsis?(t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,r.convertEntities&&(l.push(o,s,"&hellip;"),""+`[${32}mPUSH[${39}m`+o+s)):(l.push(o,s,"..."),""+`[${32}mPUSH[${39}m`+o+s);else if(u===65279)l.push(o,s),""+`[${32}mPUSH[${39}m`+o+s;else{""+`[${90}melse clause leading to encode[${39}m`,!t.dontEncodeNonLatin&&w(e[o],!0)!==w(e[o],!1)&&(t.dontEncodeNonLatin=!0,""+`[${32}mSET[${39}m`+t.dontEncodeNonLatin);let $=w(e[o],r.dontEncodeNonLatin);""+`[${33}mconvertedCharVal[${39}m`+JSON.stringify($,null,4),Object.keys(N.notEmailFriendly).includes($.slice(1,$.length-1))&&($=`&${N.notEmailFriendly[$.slice(1,$.length-1)]};`),""+`[${33}mconvertedCharVal[${39}m`+JSON.stringify($,null,4),e[o]!==$&&(t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities,r.convertEntities&&($==="&mldr;"?(""+`[${32}mPUSH[${39}m`+o+s,l.push(o,s,"&hellip;")):$!=="&apos;"&&(""+`[${32}mPUSH[${39}m`+o+s+$,l.push(o,s,$)),t.convertEntities=!0,""+`[${32}mSET[${39}m`+t.convertEntities))}v.onUrlCurrently&&!e[o].trim()&&(""+`[${33}mstate.onUrlCurrently[${39}m`,v.onUrlCurrently=!1)}""+`[${32}mfinally[${39}m`+JSON.stringify(l.current(),null,4)}var je=oe;function Te(e,r){if(typeof e!="string")throw new Error(`detergent(): [THROW_ID_01] the first input argument must be of a string type, not ${typeof e}`);if(r&&typeof r!="object")throw new Error(`detergent(): [THROW_ID_02] Options object must be a plain object, not ${typeof r}`);if(r&&r.cb&&typeof r.cb!="function")throw new Error(`detergent(): [THROW_ID_03] Options callback, opts.cb must be a function, not ${typeof r.cb} (value was given as:
${JSON.stringify(r.cb,null,0)})`);let l=R(R({},_),r);["lf","crlf","cr"].includes(l.eol)||(l.eol="lf");let o={fixBrokenEntities:!1,removeWidows:!1,convertEntities:!1,convertDashes:!1,convertApostrophes:!1,replaceLineBreaks:!1,removeLineBreaks:!1,useXHTML:!1,dontEncodeNonLatin:!1,addMissingSpaces:!1,convertDotsToEllipsis:!1,stripHtml:!1,eol:!1},s=`
`;l.eol==="crlf"?s=`\r
`:l.eol==="cr"&&(s="\r");let d=[],a=new Y.Ranges({limitToBeAddedWhitespace:!1}),v=new Y.Ranges;function t(){e=(0,H.rApply)(e,a.current()),a.wipe()}function h(c){return Number.isInteger(c)}let D={onUrlCurrently:!1};""+`[${32}mFINAL[${39}m`+`[${33}mopts[${39}m`+JSON.stringify(l,null,4),""+`[${90}m================= NEXT STEP. Initial =================[${39}m`,e=(0,me.trimSpaces)(e.replace((0,pe.default)(),"").replace(/\u200A/g," "),{cr:!0,lf:!0,tab:!0,space:!0,nbsp:!1}).res,""+JSON.stringify(e,null,0);let u=e,$;do $=u,u=he.default.decode(u);while(u!==e&&$!==u);e!==u&&(e=u),""+JSON.stringify(e,null,0),e=(0,G.collapse)(e,{trimLines:!0,removeEmptyLines:!0,limitConsecutiveEmptyLinesTo:1}).result,""+JSON.stringify(e,null,0);for(let c=0,n=e.length;c<n;c++)if(e[c].charCodeAt(0)===65533)if(e[c-1]&&e[c+1]&&(e[c-1].toLowerCase()==="n"&&e[c+1].toLowerCase()==="t"||j(e[c-1])&&e[c+1].toLowerCase()==="s")||e[c+2]&&((e[c+1].toLowerCase()==="r"||e[c+1].toLowerCase()==="v")&&e[c+2].toLowerCase()==="e"||e[c+1].toLowerCase()==="l"&&e[c+2].toLowerCase()==="l")&&(e[c-3]&&e[c-3].toLowerCase()==="y"&&e[c-2].toLowerCase()==="o"&&e[c-1].toLowerCase()==="u"||e[c-2]&&e[c-2].toLowerCase()==="w"&&e[c-1].toLowerCase()==="e"||e[c-4]&&e[c-4].toLowerCase()==="t"&&e[c-3].toLowerCase()==="h"&&e[c-2].toLowerCase()==="e"&&e[c-1].toLowerCase()==="y")||(e[c-1]&&e[c-1].toLowerCase()==="i"||e[c-2]&&e[c-2].toLowerCase()==="h"&&e[c-1].toLowerCase()==="e"||e[c-3]&&e[c-3].toLowerCase()==="s"&&e[c-2].toLowerCase()==="h"&&e[c-1].toLowerCase()==="e")&&e[c+2]&&e[c+1].toLowerCase()==="l"&&e[c+2].toLowerCase()==="l"||e[c-5]&&e[c+2]&&e[c-5].toLowerCase()==="m"&&e[c-4].toLowerCase()==="i"&&e[c-3].toLowerCase()==="g"&&e[c-2].toLowerCase()==="h"&&e[c-1].toLowerCase()==="t"&&e[c+1]==="v"&&e[c+2]==="e"||e[c-1]&&e[c-1].toLowerCase()==="s"&&(!e[c+1]||!j(e[c+1])&&!f(e[c+1]))){let S=l.convertApostrophes?B:"'";a.push(c,c+1,`${S}`),""+c+(c+1)+S,o.convertApostrophes=!0}else e[c-2]&&P(e[c-2])&&!e[c-1].trim()&&e[c+2]&&P(e[c+2])&&!e[c+1].trim()?(a.push(c,c+1,T),""+c+(c+1)+T):(a.push(c,c+1),""+c+(c+1));t(),""+`[${90}m================= NEXT STEP. fix broken HTML entity references =================[${39}m`;let i=(0,ue.fixEnt)(e,{decode:!1});if(i&&i.length&&(o.fixBrokenEntities=!0,l.fixBrokenEntities&&(e=(0,H.rApply)(e,i),""+JSON.stringify(e,null,0))),typeof l.cb=="function")if(e.includes("<")||e.includes(">")){""+`[${90}m================= NEXT STEP. HTML tags, pt.1 =================[${39}m`;let c=(0,K.stripHtml)(e,{cb:({tag:S,rangesArr:C})=>(""+`[${33}mtag[${39}m`+JSON.stringify(S,null,4),C.push(S.lastOpeningBracketAt,S.lastClosingBracketAt+1)),skipHtmlDecoding:!0}).ranges,n=((0,be.rInvert)(c,e.length)||[]).reduce((S,C)=>typeof l.cb=="function"&&e.slice(C[0],C[1])!==l.cb(e.slice(C[0],C[1]))?S.concat([[C[0],C[1],l.cb(e.slice(C[0],C[1]))]]):S,[]);""+`[${33}moutsideTagRanges[${39}m`+JSON.stringify(n,null,4),Array.isArray(n)&&n.length&&(""+e,e=(0,H.rApply)(e,n),""+e)}else""+e,e=l.cb(e),""+e;if(e.includes("<")||e.includes(">")){""+`[${90}m================= NEXT STEP. HTML tags, pt.2 =================[${39}m`;let c=({tag:n,deleteFrom:S,deleteTo:C,proposedReturn:A})=>{if(""+`[${33}mtag[${39}m`+JSON.stringify(n,null,4),h(n.lastOpeningBracketAt)&&h(n.lastClosingBracketAt)&&n.lastOpeningBracketAt<n.lastClosingBracketAt||n.slashPresent){if(o.stripHtml=!0,""+`[${32}mSET[${39}m`+o.stripHtml,v.push(n.lastOpeningBracketAt,n.lastClosingBracketAt?n.lastClosingBracketAt+1:e.length),""+`[${32}mPUSH[${39}m`+n.lastOpeningBracketAt+(n.lastClosingBracketAt?n.lastClosingBracketAt+1:e.length),l.stripHtml&&!l.stripHtmlButIgnoreTags.includes(n.name.toLowerCase()))Array.isArray(l.stripHtmlAddNewLine)&&l.stripHtmlAddNewLine.length&&l.stripHtmlAddNewLine.some(E=>E.startsWith("/")&&n.slashPresent&&n.slashPresent<n.nameEnds&&n.name.toLowerCase()===E.slice(1)||!E.startsWith("/")&&!(n.slashPresent&&n.slashPresent<n.nameEnds)&&n.name.toLowerCase()===le(E))?(o.removeLineBreaks=!0,""+`[${32}mSET[${39}m`+`[${33}mapplicableOpts.removeLineBreaks[${39}m`+o.removeLineBreaks,!l.removeLineBreaks&&typeof S=="number"&&typeof C=="number"?(o.replaceLineBreaks=!0,""+`[${32}mSET[${39}m`+`[${33}mapplicableOpts.replaceLineBreaks[${39}m`+o.replaceLineBreaks,l.replaceLineBreaks&&(o.useXHTML=!0,""+`[${32}mSET[${39}m`+`[${33}mapplicableOpts.useXHTML[${39}m`+o.useXHTML),a.push(S,C,`${l.replaceLineBreaks?`<br${l.useXHTML?"/":""}>`:""}
`),""+`[${32}mPUSH[${39}m`+JSON.stringify([S,C,`${l.replaceLineBreaks?`<br${l.useXHTML?"/":""}>`:""}
`],null,0),""+JSON.stringify(a.current(),null,4)):(a.push(A),""+`[${32}mPUSH[${39}m`+JSON.stringify(A,null,4))):(a.push(A),v.push(A),""+`[${32}mPUSH[${39}m`+`[${33}mfinalIndexesToDelete[${39}m`+`[${33}mskipArr[${39}m`+JSON.stringify(A,null,4));else{if(Q.includes(n.name.toLowerCase())){if(o.useXHTML=!0,""+`[${32}mSET[${39}m`+o.useXHTML,e[(0,b.left)(e,n.lastClosingBracketAt)]!=="/"&&n.lastClosingBracketAt&&l.useXHTML&&(""+`[${32}mPUSH[${39}m`+n.lastClosingBracketAt+n.lastClosingBracketAt,a.push(n.lastClosingBracketAt,n.lastClosingBracketAt,"/")),n.slashPresent&&h(n.lastOpeningBracketAt)&&n.nameStarts&&n.lastOpeningBracketAt<n.nameStarts-1&&e.slice(n.lastOpeningBracketAt+1,n.nameStarts).split("").every(E=>!E.trim()||E==="/")&&(""+`[${32}mPUSH[${39}m`+(n.lastOpeningBracketAt+1)+n.nameStarts,a.push(n.lastOpeningBracketAt+1,n.nameStarts)),""+JSON.stringify(a.current(),null,4),n.slashPresent&&e[(0,b.left)(e,n.lastClosingBracketAt)]==="/"){if(e[(0,b.left)(e,(0,b.left)(e,n.lastClosingBracketAt))]==="/")o.useXHTML=!0,""+`[${32}mSET[${39}m`+o.useXHTML,(!l.useXHTML||typeof(0,b.chompLeft)(e,n.lastClosingBracketAt,{mode:2},"/")=="number"&&e.slice((0,b.chompLeft)(e,n.lastClosingBracketAt,{mode:2},"/"),n.lastClosingBracketAt)!=="/")&&(a.push((0,b.chompLeft)(e,n.lastClosingBracketAt,{mode:2},"/"),n.lastClosingBracketAt,l.useXHTML?"/":void 0),""+`[${32}mPUSH[${39}m`+(0,b.chompLeft)(e,n.lastClosingBracketAt,{mode:2},"/")+n.lastClosingBracketAt+(l.useXHTML?"/":void 0));else if(!l.useXHTML||typeof(0,b.left)(e,n.slashPresent)!="number"||e.slice((0,b.left)(e,n.slashPresent)+1,n.lastClosingBracketAt)!=="/"){let E=(0,b.left)(e,n.slashPresent)+1,J=n.lastClosingBracketAt,X=l.useXHTML?"/":null;X?(""+`[${32}mPUSH[${39}m`+E+J+X,a.push(E,J,X)):(""+`[${32}mPUSH[${39}m`+E+J,a.push(E,J))}}}else n.slashPresent&&e[(0,b.left)(e,n.lastClosingBracketAt)]==="/"&&(a.push((0,b.chompLeft)(e,n.lastClosingBracketAt,{mode:2},"/"),n.lastClosingBracketAt),a.push(n.lastOpeningBracketAt+1,n.lastOpeningBracketAt+1,"/"));""+JSON.stringify(a.current(),null,4),n.name.toLowerCase()!==n.name&&(""+`[${32}mPUSH[${39}m`+n.nameStarts+n.nameEnds+n.name.toLowerCase(),a.push(n.nameStarts,n.nameEnds,n.name.toLowerCase())),"/>".includes(e[(0,b.right)(e,n.nameEnds-1)])&&((0,b.right)(e,n.nameEnds-1)||0)>n.nameEnds&&(""+`[${32}mPUSH[${39}m`+n.nameEnds+(0,b.right)(e,n.nameEnds-1),a.push(n.nameEnds,(0,b.right)(e,n.nameEnds-1))),h(n.lastOpeningBracketAt)&&h(n.nameStarts)&&n.lastOpeningBracketAt+1<n.nameStarts&&(e.slice(n.lastOpeningBracketAt+1,n.nameStarts).trim().length?!Q.includes(n.name.toLowerCase())&&e.slice(n.lastOpeningBracketAt+1,n.nameStarts).split("").every(E=>!E.trim()||E==="/")&&(a.push(n.lastOpeningBracketAt+1,n.nameStarts,"/"),""+`[${32}mPUSH[${39}m`+(n.lastOpeningBracketAt+1)+n.nameStarts):(""+`[${32}mPUSH[${39}m`+(n.lastOpeningBracketAt+1)+n.nameStarts,a.push(n.lastOpeningBracketAt+1,n.nameStarts)))}n.name.toLowerCase()==="br"&&n.lastClosingBracketAt&&(d.push(n.lastClosingBracketAt),""+JSON.stringify(d,null,0)),["ul","li"].includes(n.name.toLowerCase())&&!l.removeLineBreaks&&e[n.lastOpeningBracketAt-1]&&!e[n.lastOpeningBracketAt-1].trim()&&typeof n.lastOpeningBracketAt=="number"&&typeof(0,b.leftStopAtNewLines)(e,n.lastOpeningBracketAt)=="number"&&(a.push((0,b.leftStopAtNewLines)(e,n.lastOpeningBracketAt)+1,n.lastOpeningBracketAt),""+`[${32}mPUSH[${39}m`+((0,b.leftStopAtNewLines)(e,n.lastOpeningBracketAt)+1)+n.lastOpeningBracketAt),e[n.lastClosingBracketAt-1]&&!e[n.lastClosingBracketAt-1].trim()&&typeof n.lastClosingBracketAt=="number"&&typeof(0,b.left)(e,n.lastClosingBracketAt)=="number"&&(a.push((0,b.left)(e,n.lastClosingBracketAt)+1,n.lastClosingBracketAt),""+`[${32}mPUSH[${39}m`+((0,b.left)(e,n.lastClosingBracketAt)+1)+n.lastClosingBracketAt)}""+`[${90}m========================================
ENDING finalIndexesToDelete[]:
[${39}m`,""+`[${90}m${JSON.stringify(a.current(),null,4)}[${39}m`};""+`[${90}m========================================[${39}m`,(0,K.stripHtml)(e,{cb:c,trimOnlySpaces:!0,ignoreTags:l.stripHtml?l.stripHtmlButIgnoreTags:[],skipHtmlDecoding:!0})}""+(e.includes("<")||e.includes(">")?"":"no tags found"),""+`[${33}mrangesArr[${39}m`+JSON.stringify(a.current(),null,0)+`[${33}mskipArr[${39}m`+JSON.stringify(v.current(),null,0),""+`[${90}m================= NEXT STEP. Process outside tags =================[${39}m`,(0,ae.rProcessOutside)(e,v.current(),(c,n,S)=>ce(e,l,a,c,n,S,d,D,o,s),!0),""+36+39+35+36+39,""+`[${33}mstr[${39}m`+JSON.stringify(e,null,0)+`[${33}mrangesArr.current()[${39}m`+JSON.stringify(a.current(),null,4),""+`[${33}mapplicableOpts[${39}m`+JSON.stringify(o,null,4),""+`[${90}m================= NEXT STEP. apply+wipe =================[${39}m`,""+`[${33}mstr[${39}m`+JSON.stringify(e,null,4),t(),""+`[${33}mstr[${39}m`+JSON.stringify(e,null,4),e=e.replace(/ (<br[/]?>)/g,"$1"),e=e.replace(/(\r\n|\r|\n){3,}/g,`${s}${s}`),""+`[${33}mstr[${39}m`+JSON.stringify(e,null,4),""+`[${33}mfinalIndexesToDelete.current()[${39}m`+JSON.stringify(a.current(),null,4),""+`[${90}m================= NEXT STEP. widows =================[${39}m`,""+`[${33}mskipArr.current()[${39}m`+JSON.stringify(v.current(),null,4);let p=(0,ie.removeWidows)(e,{ignore:"all",convertEntities:l.convertEntities,targetLanguage:"html",UKPostcodes:!0,hyphens:l.convertDashes,tagRanges:v.current()});return""+`[${33}mwidowFixes[${39}m`+JSON.stringify(p,null,4),p&&p.ranges&&p.ranges.length&&(!o.removeWidows&&p.whatWasDone.removeWidows&&(o.removeWidows=!0,""+`[${32}mSET[${39}m`+`[${33}mapplicableOpts.removeWidows[${39}m`,l.removeWidows&&(o.convertEntities=!0,""+`[${32}mSET[${39}m`+`[${33}mapplicableOpts.convertEntities[${39}m`)),!o.convertEntities&&p.whatWasDone.convertEntities&&(o.convertEntities=!0,""+`[${32}mSET[${39}m`+`[${33}mapplicableOpts.convertEntities[${39}m`),l.removeWidows&&(e=p.res,""+JSON.stringify(e,null,0))),""+`[${90}m================= NEXT STEP. linebreaks =================[${39}m`,""+`[${33}mbrClosingBracketIndexesArr[${39}m`+JSON.stringify(d,null,4),e!==e.replace(/\r\n|\r|\n/gm," ")&&(o.removeLineBreaks=!0,l.removeLineBreaks&&(e=e.replace(/\r\n|\r|\n/gm," "))),""+`[${90}m================= NEXT STEP. collapse =================[${39}m`,""+JSON.stringify(e,null,0),e=(0,G.collapse)(e,{trimLines:!0}).result,""+JSON.stringify(e,null,0),""+`[${90}m================= NEXT STEP. final =================[${39}m`,(0,H.rApply)(e,a.current()).split("").forEach((c,n)=>{""+n+`[${33}mkey[${39}m`+JSON.stringify(c,null,4)+`[${35}m${c.charCodeAt(0)}[${39}m`}),""+JSON.stringify({res:(0,H.rApply)(e,a.current()),applicableOpts:o},null,4),{res:(0,H.rApply)(e,a.current()),applicableOpts:o}}
